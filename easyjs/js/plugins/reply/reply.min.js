(function(e){e.simpleReply=e.simpleReply||{};e.display=e.display||{};e.displayPanel=e.displayPanel||{};e.simpleReply.defaults={submitUrl:"/reply/reply.do",title:"",content:"",resourceId:null,resourceType:null,success:null,error:null};e.display.defaultsDisply={submitUrl:"/reply.do",resourceId:null,resourceType:null,width:"100%",isDelete:false,delUrl:"/reply/delete.do",success:null,error:null};e.displayPanel.defaultReply={submitUrl:"/reply/reply.do",title:false,width:"100%",resourceId:null,resourceType:null,success:null,error:null};e.extend({utils:{reply:function(r){r=e.extend({},e.simpleReply.defaults,r||{});var t={validate:function(){if(!r.content||e.trim(r.content)==""){alert("回复内容不能为空!");return false}if(!r.resourceId||!r.resourceType){alert("参数不正确!");return false}return true},replyRequest:function(){var t=easyloader.URI+r.submitUrl;var l="resourceId="+r.resourceId+"&resourceType="+r.resourceType+"&title="+r.title+"&content="+r.content;e.ajax({url:t,type:"post",dataType:"json",data:l,success:function(e){if(e.status=="1"){if(r.success)return r.success(e.replyId);else alert("发表回复成功")}else{if(r.error)return r.error(e.replyId);else alert("发表回复失败")}},error:function(e){alert("系统error!")}})}};if(t.validate()){t.replyRequest()}}}});e.fn.displayReply=function(r){this.each(function(){r=e.extend({},e.display.defaultsDisply,r||{});var t=e(this);var l=this.tagName.toLowerCase();var s={validate:function(){if(!r.resourceId||!r.resourceType){alert("参数配置错误!");return false}if(l!="div"){alert("展示回复的容器必须为DIV");return false}return true},display:function(){var l=r.width;if(typeof l=="number")l=r.width+"px";var a=easyloader.URI+r.submitUrl;var i="resourceId="+r.resourceId+"&resourceType="+r.resourceType;e.ajax({url:a,type:"post",dataType:"json",data:i,success:function(a){var i=a.reply.items;if(i&&i.length>0){var u={reply:i,isDelete:r.isDelete,width:l};var n=e.util.from("displayReply");var o=n.process(u);if(t){t.html(o);s.addEvent()}}},error:function(e){alert("网络错误,请稍后重试!")}})},addEvent:function(){var r=e(document).find("a.deleteLink");r.each(function(){e(this).bind("click",function(){s.deleteReply(this)})})},deleteReply:function(t){var l=easyloader.URI+r.delUrl+"?replyId="+e(t).attr("replyId");var s=window.confirm(e.util.getMessage("reply.delete.confirm"));if(!s)return;e.ajax({type:"post",dataType:"json",url:l,success:function(l){if(l.status=="1"){if(r.success)return r.success();else{var s=e("#replyLi"+e(t).attr("replyId"));s.fadeOut("slow")}}else{if(r.error)return r.error();else{alert("删除失败!")}}},error:function(){alert("错误！可能原因：参数配置错误、响应出现异常。")}})}};if(s.validate()){s.display()}})};e.fn.reply=function(r){this.each(function(){r=e.extend({},e.displayPanel.defaultReply,r||{});var t=e(this);var l=this.tagName.toLowerCase();var s={validate:function(){if(!r.resourceId||!r.resourceType){alert("参数配置错误!");return false}if(l!="div"){alert("回复组件的容器必须为DIV");return false}return true},show:function(){var l=r.width;if(typeof l=="number")l=r.width+"px";var s={title:r.title,width:l};var a=e.util.from("toReply");var i=a.process(s);if(t)t.html(i)},addEvent:function(){var t=e("#replyBtn");var l=easyloader.URI+r.submitUrl+"?resourceId="+r.resourceId+"&resourceType="+r.resourceType;t.bind("click",function(){var t=e("#reply-form");if(t){var s=Validator.Validate(t[0],3);if(s){t.ajaxSubmit({type:"post",url:l,resetForm:true,dataType:"json",success:function(e){if(e.status=="1"){if(r.success)return r.success(e.replyId);else alert("发表回复成功")}else{if(r.error)return r.error(e.replyId);else alert("发表回复失败")}},error:function(e){alert("错误！可能原因：参数配置错误、响应出现异常。")}})}}})}};if(s.validate()){s.show();s.addEvent()}})}})(jQuery);