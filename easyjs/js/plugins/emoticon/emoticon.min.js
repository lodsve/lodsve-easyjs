(function(e){e.emoticon=e.emoticon||{};e.displayEmoticon=e.displayEmoticon||{};e.emoticon.defaults={id:"emoticon"+(new Date).getTime(),preview:true,panel:""};e.displayEmoticon.defaults={allowArea:"p|span|div"};e.emoticon.panel=e.emoticon.panel||null;e.fn.emoticon=function(i){this.each(function(){i=e.extend({},e.emoticon.defaults,i||{});var a=e(this);var t={getBody:function(e,a,t){var o=e+a+1;var n="";n+="<div>";n+='	<div class="qz_emotion_bd" style="">';n+='		<div class="qzfl_emotion_page_'+t+'" style="height: 190px;">';if(i.preview){n+='		<div class="emotion_preview_default" style="display: none">';n+="			<img/>";n+="			<span>undefined</span>";n+="		</div>"}n+='			<ul class="qzfl_emotion_default" style="margin-top: 0px; margin-bottom: 0px; padding-left: 0px;">';for(var s=e;s<o;s++){n+='			<li class="singleEmonLi">';n+='				<a data-id="e'+s+'" href="javascript:void(0);" id="e'+s+'" class="singleEmoticon">';n+='					<div class="icon"></div>';n+="				</a>";n+="			</li>"}n+="			</ul>";n+="		</div>";n+="	</div>";n+="</div>";return n},getOffset:function(i){var t=a.offset();var o=t.top-(220+33);var n=t.left-390*.8;var s=e(window).width();var d=e(window).height();if(o<220){o=t.top+33;if(i)e("#decor").removeClass("decor").addClass("decor1").css("bottom",220+10+"px")}if(n<0){n=0;if(i)e("#decor").css("left",t.left+5)}else if(n+390>s){n=s-290-22;if(i)e("#decor").css("left",t.left-n+5)}return[n,o]},getFoot:function(){var e="";e+='		<div class="qz_emotion_magic_ft">';e+='			<div class="qz_page_nav">';e+='				<input type="hidden" id="page" value="1"/>';e+='				<a href="javascript:void(0);" class="ui_mr5 prePage">上一页</a>';e+='					<span class="page_info ui_mr5"><span id="nowPage">1</span>/6</span>';e+='				<a href="javascript:void(0);" class="ui_mr5 nextPage">下一页</a>';e=="			</div>";e+="		</div>";e+='<div id="decor" class="decor"></div>';return e},insertIntoPanel:function(a){var t=a.attr("data-id");var a="["+t+"]";if(!i.panel){alert("目标容器ID不能为空!");return}var o=e("#"+i.panel);if(o==null||o.length==0){alert("目标容器ID错误!");return}var n=o.val();o.focus();o.val(n+a)},addEmoticonEvent:function(){e("a.singleEmoticon").click(function(){t.insertIntoPanel(e(this))});if(i.preview){e("li.singleEmonLi").mouseover(function(){var i=e(this).children("a.singleEmoticon");if(!i){return}var a=e(i).attr("data-id");var t=e(this).position();if(t.left<90){e("div.emotion_preview_default").addClass("floatRight");e("div.emotion_preview_default").removeClass("floatLeft")}else if(e("div.qz_emotion_bd").width()-t.left<90){e("div.emotion_preview_default").addClass("floatLeft");e("div.emotion_preview_default").removeClass("floatRight")}var o=e.util.getEmoticonTitle(a);e("div.emotion_preview_default > img").attr("src",easyloader.base+"plugins/images/emoticon/images/"+o[0]+"/"+a+".gif");e("div.emotion_preview_default > span").html(o[1]);e("div.emotion_preview_default").show()});e("li.singleEmonLi").mouseout(function(){e("div.emotion_preview_default").hide()})}},addPageEvent:function(){e("a.prePage").bind("click",function(){var a=parseInt(e("#page").val());if(a!=1){e("a.nextPage").removeClass("disable");if(a==2){e.emoticon.panel.setBody(t.getBody(100,104,1));e("a.prePage").addClass("disable")}else if(a!=1){e.emoticon.panel.setBody(t.getBody(7e3+(a-3)*105,104,a-1))}else{}e("#page").val(a-1);e("#nowPage").html(a-1);e("div.bd",e("#"+i.id)).css("height",185);t.addEmoticonEvent()}});e("a.nextPage").bind("click",function(){var a=parseInt(e("#page").val());if(a!=6){e("a.prePage").removeClass("disable");if(a!=5){e.emoticon.panel.setBody(t.getBody(7e3+(a-1)*105,104,a+1))}else if(a==5){e.emoticon.panel.setBody(t.getBody(7420,30,6));e("a.nextPage").addClass("disable")}else{}e("#page").val(a+1);e("#nowPage").html(a+1);e("div.bd",e("#"+i.id)).css("height",185);t.addEmoticonEvent()}else{e("a.nextPage").addClass("disable")}})},hidePanel:function(){if(e.emoticon.panel){e.emoticon.panel.hide()}},show:function(){e.emoticon.panel=new YAHOO.widget.Overlay(i.id,{xy:t.getOffset(false),visible:false,width:390,height:220});e.emoticon.panel.setHeader("");e.emoticon.panel.setBody(t.getBody(100,104,1));e.emoticon.panel.setFooter(t.getFoot());e.emoticon.panel.render(document.body);e("#"+i.id).css("width",390);e("#"+i.id).css("height",220);e("div.bd",e("#"+i.id)).css("height",185);this.getOffset(true);e.emoticon.panel.show();e("a.prePage").addClass("disable");t.addEmoticonEvent();t.addPageEvent();t.addWindowEvent()},addWindowEvent:function(){var a=function(a){var o=a.pageX;var n=a.pageY;var s=t.getOffset();if(e("#"+i.id).css("visibility")&&e("#"+i.id).css("visibility")=="visible"){if(!(o>s[0]&&o<s[0]+390&&(n>s[1]&&n<s[1]+220))){if(e.emoticon.panel){e.emoticon.panel.hide();e(document).unbind("mousedown")}}}};e(document).bind("mousedown",a)}};a.bind("click",function(){t.show()})})};e.fn.displayEmoticon=function(i){this.each(function(){i=e.extend({},e.displayEmoticon.defaults,i||{});var a=e(this);var t=this.tagName.toLowerCase();var o={display:function(){var n=i.allowArea.split("|");var s=e.util.contain(t,n);if(!s)return false;var d=a.html();var l=/\[e[0-9]{3,4}\]/g;var r=e.trim(d).match(l);d=o.makeImage(r,d);a.html(d)},makeImage:function(i,a){if(!i){return}for(var t=0;t<i.length;t++){var o=i[t];var n=/e[0-9]{3,4}/g;var s=o.match(n)[0];var o=e.util.getEmoticonTitle(s);if(!o)continue;var d='<img src="'+easyloader.base+"plugins/images/emoticon/images/"+o[0]+"/"+s+'.gif" title="'+o[1]+'">';a=a.replace("["+s+"]",d)}return a}};o.display()})}})(jQuery);