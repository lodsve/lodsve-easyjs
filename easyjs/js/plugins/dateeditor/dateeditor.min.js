if(typeof LigerUIManagers=="undefined")LigerUIManagers={};(function($){$.fn.getDateEditorManager=function(){return LigerUIManagers[this[0].id+"_DateEditor"]};$.ligerDefaults=$.ligerDefaults||{};$.ligerDefaults.DateEditor={format:"yyyy-MM-dd hh:mm",showTime:false,onChangeDate:false,readonly:true,clear:true};$.ligerDefaults.DateEditorString={dayMessage:["日","一","二","三","四","五","六"],monthMessage:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],todayMessage:"今天",closeMessage:"关闭"};$.fn.dateEditor=function(options){this.each(function(){var singleId=(new Date).getTime();if(this.useDateEditor)return;var p=$.extend({},options||{});if($(this).attr("ligerui")){try{var attroptions=$(this).attr("ligerui");if(attroptions.indexOf("{")<0)attroptions="{"+attroptions+"}";eval("attroptions = "+attroptions+";");if(attroptions)p=$.extend({},attroptions,p||{})}catch(e){}}p=$.extend({},$.ligerDefaults.DateEditor,$.ligerDefaults.DateEditorString,p);if(!p.showTime&&p.format.indexOf(" hh:mm")>-1)p.format=p.format.replace(" hh:mm","");if(this.tagName.toLowerCase()!="input"||this.type!="text")return;var g={bulidContent:function(){var e=new Date(g.currentDate.year,g.currentDate.month-1,1).getDay();var t=g.currentDate.month;var i=g.currentDate.year;if(++t==13){t=1;i++}var l=new Date(i,t-1,0).getDate();var a=new Date(g.currentDate.year,g.currentDate.month-1,0).getDate();g.buttons.btnMonth.html(p.monthMessage[g.currentDate.month-1]);g.buttons.btnYear.html(g.currentDate.year);g.toolbar.time.hour.html(g.currentDate.hour);g.toolbar.time.minute.html(g.currentDate.minute);if(g.toolbar.time.hour.html().length==1)g.toolbar.time.hour.html("0"+g.toolbar.time.hour.html());if(g.toolbar.time.minute.html().length==1)g.toolbar.time.minute.html("0"+g.toolbar.time.minute.html());$("td",this.body.tbody).each(function(){this.className=""});$("tr",this.body.tbody).each(function(t,i){$("td",i).each(function(i,o){var r=t*7+(i-e);var d=r+1;if(g.selectedDate&&g.currentDate.year==g.selectedDate.year&&g.currentDate.month==g.selectedDate.month&&r+1==g.selectedDate.date){if(i==0||i==6){$(o).addClass("l-box-dateeditor-holiday")}$(o).addClass("l-box-dateeditor-selected");$(o).siblings().removeClass("l-box-dateeditor-selected")}else if(g.currentDate.year==g.now.year&&g.currentDate.month==g.now.month&&r+1==g.now.date){if(i==0||i==6){$(o).addClass("l-box-dateeditor-holiday")}$(o).addClass("l-box-dateeditor-today")}else if(r<0){d=a+d;$(o).addClass("l-box-dateeditor-out").removeClass("l-box-dateeditor-selected")}else if(r>l-1){d=d-l;$(o).addClass("l-box-dateeditor-out").removeClass("l-box-dateeditor-selected")}else if(i==0||i==6){$(o).addClass("l-box-dateeditor-holiday").removeClass("l-box-dateeditor-selected")}else{o.className=""}$(o).html(d)})})},toggleDateEditor:function(e){var t=g.text.height();g.editorToggling=true;if(e){g.dateeditor.hide("fast",function(){g.editorToggling=false})}else{if(g.text.offset().top+4>g.dateeditor.height()&&g.text.offset().top+g.dateeditor.height()+t+4-$(window).scrollTop()>$(window).height()){g.dateeditor.css("marginTop",-1*(g.dateeditor.height()+t+5));g.showOnTop=true}else{g.showOnTop=false}g.dateeditor.slideDown("fast",function(){g.editorToggling=false})}},showDate:function(){if(!this.selectedDate)return;var e=g.selectedDate.year+"/"+g.selectedDate.month+"/"+g.selectedDate.date;this.currentDate.hour=parseInt(g.toolbar.time.hour.html());this.currentDate.minute=parseInt(g.toolbar.time.minute.html());if(p.showTime){e+=" "+this.currentDate.hour+":"+this.currentDate.minute}this.inputText.val(e);this.inputText.trigger("change").focus()},isDateTime:function(e){var t=e.match(/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2})$/);if(t==null)return false;var i=new Date(t[1],t[3]-1,t[4]);if(i=="NaN")return false;return i.getFullYear()==t[1]&&i.getMonth()+1==t[3]&&i.getDate()==t[4]},isLongDateTime:function(e){var t=/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2}) (\d{1,2}):(\d{1,2})(:(\d{1,2})){0,1}$/;var i=e.match(t);if(i==null)return false;var l=new Date(i[1],i[3]-1,i[4],i[5],i[6]);if(l=="NaN")return false;return l.getFullYear()==i[1]&&l.getMonth()+1==i[3]&&l.getDate()==i[4]&&l.getHours()==i[5]&&l.getMinutes()==i[6]},getFormatDate:function(e){if(e=="NaN")return null;var t=p.format;var i={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};if(/(y+)/.test(t)){t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))}for(var l in i){if(new RegExp("("+l+")").test(t)){t=t.replace(RegExp.$1,RegExp.$1.length==1?i[l]:("00"+i[l]).substr((""+i[l]).length))}}return t},onTextChange:function(){var e=g.inputText.val();if(e==""){g.selectedDate=null;return true}if(!p.showTime&&!g.isDateTime(e)){if(!g.usedDate){g.inputText.val("")}else{g.inputText.val(g.getFormatDate(g.usedDate))}}else if(p.showTime&&!g.isLongDateTime(e)){if(!g.usedDate){g.inputText.val("")}else{g.inputText.val(g.getFormatDate(g.usedDate))}}else{while(e.indexOf("-")>-1)e=e.replace("-","/");var t=g.getFormatDate(new Date(e));if(t==null){if(!g.usedDate){g.inputText.val("")}else{g.inputText.val(g.getFormatDate(g.usedDate))}}g.usedDate=new Date(e);g.selectedDate={year:g.usedDate.getFullYear(),month:g.usedDate.getMonth()+1,day:g.usedDate.getDay(),date:g.usedDate.getDate(),hour:g.usedDate.getHours(),minute:g.usedDate.getMinutes(),second:g.usedDate.getSeconds()};g.currentDate={year:g.usedDate.getFullYear(),month:g.usedDate.getMonth()+1,day:g.usedDate.getDay(),date:g.usedDate.getDate(),hour:g.usedDate.getHours(),minute:g.usedDate.getMinutes(),second:g.usedDate.getSeconds()};g.inputText.val(t);if(p.onChangeDate){p.onChangeDate(t)}if($(g.dateeditor).is(":visible"))g.bulidContent()}},setDisabled:function(){g.inputText.attr("readonly","readonly");g.text.addClass("l-text-disabled");p.disabled=true},setEnabled:function(){g.inputText.removeAttr("readonly");g.text.removeClass("l-text-disabled");p.disabled=false},getValue:function(){return g.inputText.val()},setValue:function(value){if(!value)g.inputText.val("");if(typeof value=="string"){if(/^\/Date/.test(value)){value=value.replace(/^\//,"new ").replace(/\/$/,"");eval("value = "+value)}else{g.inputText.val(value)}}if(typeof value=="object"){if(value instanceof Date){g.inputText.val(g.getFormatDate(value));g.onTextChange()}}}};g.inputText=$(this);if(!g.inputText.hasClass("l-text-field"))g.inputText.addClass("l-text-field");if(p.readonly)g.inputText.attr("readonly","readonly");g.link=$('<div class="l-trigger"><div class="l-trigger-icon"></div></div>');g.text=g.inputText.wrap('<div class="l-text l-text-date"></div>').parent();g.text.append('<div class="l-text-l"></div><div class="l-text-r"></div>');g.text.append(g.link);if(p.clear){g.clearBtn=$('<div class="l-trigger l-trigger-cancel"><div class="l-trigger-icon"></div></div>');g.text.append(g.clearBtn)}var dateeditorHTML="";dateeditorHTML+="<div class='l-box-dateeditor' style='display:none;'>";dateeditorHTML+="    <div class='l-box-dateeditor-header'>";dateeditorHTML+="        <div class='l-box-dateeditor-header-btn l-box-dateeditor-header-prevyear'><span></span></div>";dateeditorHTML+="        <div class='l-box-dateeditor-header-btn l-box-dateeditor-header-prevmonth'><span></span></div>";dateeditorHTML+="        <div class='l-box-dateeditor-header-text'><a class='l-box-dateeditor-header-month'></a> , <a  class='l-box-dateeditor-header-year'></a></div>";dateeditorHTML+="        <div class='l-box-dateeditor-header-btn l-box-dateeditor-header-nextmonth'><span></span></div>";dateeditorHTML+="        <div class='l-box-dateeditor-header-btn l-box-dateeditor-header-nextyear'><span></span></div>";dateeditorHTML+="    </div>";dateeditorHTML+="    <div class='l-box-dateeditor-body'>";dateeditorHTML+="        <table cellpadding='0' cellspacing='0' border='0' class='l-box-dateeditor-calendar'>";dateeditorHTML+="            <thead>";dateeditorHTML+="                <tr><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr>";dateeditorHTML+="            </thead>";dateeditorHTML+="            <tbody>";dateeditorHTML+="                <tr><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr><tr><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr><tr><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr><tr><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr><tr><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr><tr><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr>";dateeditorHTML+="            </tbody>";dateeditorHTML+="        </table>";dateeditorHTML+="        <ul class='l-box-dateeditor-monthselector'><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul>";dateeditorHTML+="        <ul class='l-box-dateeditor-yearselector'><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul>";dateeditorHTML+="        <ul class='l-box-dateeditor-hourselector'><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul>";dateeditorHTML+="        <ul class='l-box-dateeditor-minuteselector'><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul>";dateeditorHTML+="    </div>";dateeditorHTML+="    <div class='l-box-dateeditor-toolbar'>";dateeditorHTML+="        <div class='l-box-dateeditor-time'></div>";dateeditorHTML+="        <div class='l-button l-button-today'></div>";dateeditorHTML+="        <div class='l-button l-button-close'></div>";dateeditorHTML+="        <div class='l-clear'></div>";dateeditorHTML+="    </div>";dateeditorHTML+="</div>";g.dateeditor=$(dateeditorHTML);g.dateeditor.css("marginTop",1);g.text.after(g.dateeditor);g.header=$(".l-box-dateeditor-header",g.dateeditor);g.body=$(".l-box-dateeditor-body",g.dateeditor);g.toolbar=$(".l-box-dateeditor-toolbar",g.dateeditor);g.body.thead=$("thead",g.body);g.body.tbody=$("tbody",g.body);g.body.monthselector=$(".l-box-dateeditor-monthselector",g.body);g.body.yearselector=$(".l-box-dateeditor-yearselector",g.body);g.body.hourselector=$(".l-box-dateeditor-hourselector",g.body);g.body.minuteselector=$(".l-box-dateeditor-minuteselector",g.body);g.toolbar.time=$(".l-box-dateeditor-time",g.toolbar);g.toolbar.time.hour=$("<a></a>");g.toolbar.time.minute=$("<a></a>");g.buttons={btnPrevYear:$(".l-box-dateeditor-header-prevyear",g.header),btnNextYear:$(".l-box-dateeditor-header-nextyear",g.header),btnPrevMonth:$(".l-box-dateeditor-header-prevmonth",g.header),btnNextMonth:$(".l-box-dateeditor-header-nextmonth",g.header),btnYear:$(".l-box-dateeditor-header-year",g.header),btnMonth:$(".l-box-dateeditor-header-month",g.header),btnToday:$(".l-button-today",g.toolbar),btnClose:$(".l-button-close",g.toolbar)};var nowDate=new Date;g.now={year:nowDate.getFullYear(),month:nowDate.getMonth()+1,day:nowDate.getDay(),date:nowDate.getDate(),hour:nowDate.getHours(),minute:nowDate.getMinutes(),second:nowDate.getSeconds()};g.currentDate={year:nowDate.getFullYear(),month:nowDate.getMonth()+1,day:nowDate.getDay(),date:nowDate.getDate(),hour:nowDate.getHours(),minute:nowDate.getMinutes(),second:nowDate.getSeconds()};g.selectedDate=null;g.usedDate=null;$("td",g.body.thead).each(function(e,t){$(t).html(p.dayMessage[e])});$("li",g.body.monthselector).each(function(e,t){$(t).html(p.monthMessage[e])});g.buttons.btnToday.html(p.todayMessage);g.buttons.btnClose.html(p.closeMessage);if(p.showTime){g.toolbar.time.show();g.toolbar.time.append(g.toolbar.time.hour).append(":").append(g.toolbar.time.minute);$("li",g.body.hourselector).each(function(e,t){var i=e;if(e<10)i="0"+e.toString();$(this).html(i)});$("li",g.body.minuteselector).each(function(e,t){var i=e;if(e<10)i="0"+e.toString();$(this).html(i)})}g.bulidContent();if(g.inputText.val()!=""){g.onTextChange()}g.dateeditor.hover(null,function(e){if(g.dateeditor.is(":visible")&&!g.editorToggling){g.toggleDateEditor(true)}});g.link.hover(function(){if(p.disabled)return;this.className="l-trigger-hover"},function(){if(p.disabled)return;this.className="l-trigger"}).mousedown(function(){if(p.disabled)return;this.className="l-trigger-pressed"}).mouseup(function(){if(p.disabled)return;this.className="l-trigger-hover"}).click(function(){if(p.disabled)return;g.bulidContent();g.toggleDateEditor(g.dateeditor.is(":visible"))});g.buttons.btnClose.click(function(){g.toggleDateEditor(true)});p.clear&&g.clearBtn.click(function(){g.inputText.val("")});$("td",g.body.tbody).hover(function(){if($(this).hasClass("l-box-dateeditor-today"))return;$(this).addClass("l-box-dateeditor-over")},function(){$(this).removeClass("l-box-dateeditor-over")}).click(function(){$(".l-box-dateeditor-selected",g.body.tbody).removeClass("l-box-dateeditor-selected");if(!$(this).hasClass("l-box-dateeditor-today"))$(this).addClass("l-box-dateeditor-selected");g.currentDate.date=parseInt($(this).html());g.currentDate.day=new Date(g.currentDate.year,g.currentDate.month-1,1).getDay();if($(this).hasClass("l-box-dateeditor-out")){if($("tr",g.body.tbody).index($(this).parent())==0){if(--g.currentDate.month==0){g.currentDate.month=12;g.currentDate.year--}}else{if(++g.currentDate.month==13){g.currentDate.month=1;g.currentDate.year++}}}g.selectedDate={year:g.currentDate.year,month:g.currentDate.month,date:g.currentDate.date};g.showDate();g.editorToggling=true;g.dateeditor.slideToggle("fast",function(){g.editorToggling=false})});$(".l-box-dateeditor-header-btn",g.header).hover(function(){$(this).addClass("l-box-dateeditor-header-btn-over")},function(){$(this).removeClass("l-box-dateeditor-header-btn-over")});g.buttons.btnYear.click(function(){if(!g.body.yearselector.is(":visible")){$("li",g.body.yearselector).each(function(e,t){var i=g.currentDate.year+(e-4);if(i==g.currentDate.year)$(this).addClass("l-selected");else $(this).removeClass("l-selected");$(this).html(i)})}g.body.yearselector.slideToggle()});g.body.yearselector.hover(function(){},function(){$(this).slideUp()});$("li",g.body.yearselector).click(function(){g.currentDate.year=parseInt($(this).html());g.body.yearselector.slideToggle();g.bulidContent()});g.buttons.btnMonth.click(function(){$("li",g.body.monthselector).each(function(e,t){if(g.currentDate.month==e+1)$(this).addClass("l-selected");else $(this).removeClass("l-selected")});g.body.monthselector.slideToggle()});g.body.monthselector.hover(function(){},function(){$(this).slideUp("fast")});$("li",g.body.monthselector).click(function(){var e=$("li",g.body.monthselector).index(this);g.currentDate.month=e+1;g.body.monthselector.slideToggle();g.bulidContent()});g.toolbar.time.hour.click(function(){$("li",g.body.hourselector).each(function(e,t){if(g.currentDate.hour==e)$(this).addClass("l-selected");else $(this).removeClass("l-selected")});g.body.hourselector.slideToggle()});g.body.hourselector.hover(function(){},function(){$(this).slideUp("fast")});$("li",g.body.hourselector).click(function(){var e=$("li",g.body.hourselector).index(this);g.currentDate.hour=e;g.body.hourselector.slideToggle();g.bulidContent()});g.toolbar.time.minute.click(function(){$("li",g.body.minuteselector).each(function(e,t){if(g.currentDate.minute==e)$(this).addClass("l-selected");else $(this).removeClass("l-selected")});g.body.minuteselector.slideToggle("fast",function(){var e=$("li",this).index($("li.l-selected",this));if(e>29){var t=$("li.l-selected",this).offset().top-$(this).offset().top;$(this).animate({scrollTop:t})}})});g.body.minuteselector.hover(function(){},function(){$(this).slideUp("fast")});$("li",g.body.minuteselector).click(function(){var e=$("li",g.body.minuteselector).index(this);g.currentDate.minute=e;g.body.minuteselector.slideToggle("fast");g.bulidContent()});g.buttons.btnPrevMonth.click(function(){if(--g.currentDate.month==0){g.currentDate.month=12;g.currentDate.year--}g.bulidContent()});g.buttons.btnNextMonth.click(function(){if(++g.currentDate.month==13){g.currentDate.month=1;g.currentDate.year++}g.bulidContent()});g.buttons.btnPrevYear.click(function(){g.currentDate.year--;g.bulidContent()});g.buttons.btnNextYear.click(function(){g.currentDate.year++;g.bulidContent()});g.buttons.btnToday.click(function(){g.currentDate={year:g.now.year,month:g.now.month,day:g.now.day,date:g.now.date};g.selectedDate={year:g.now.year,month:g.now.month,day:g.now.day,date:g.now.date};g.showDate();g.dateeditor.slideToggle("fast")});g.inputText.change(function(){g.onTextChange()}).blur(function(){g.text.removeClass("l-text-focus")}).focus(function(){g.text.addClass("l-text-focus")});g.text.hover(function(){g.text.addClass("l-text-over")},function(){g.text.removeClass("l-text-over")});this.useDateEditor=true;if(this.id==undefined)this.id="LigerUI_"+singleId;LigerUIManagers[this.id+"_DateEditor"]=g});if(this.length==0)return null;if(this.length==1)return LigerUIManagers[this[0].id+"_DateEditor"];var managers=[];this.each(function(){managers.push(LigerUIManagers[this.id+"_DateEditor"])});return managers}})(jQuery);