if(window.jQuery&&!window.jQuery.createTemplate){(function(jQuery){var Template=function(e,t,n){this._tree=[];this._param={};this._includes=null;this._templates={};this._templates_code={};this.settings=jQuery.extend({disallow_functions:false,filter_data:true,filter_params:false,runnable_functions:false,clone_data:true,clone_params:true},n);this.f_cloneData=this.settings.f_cloneData!==undefined?this.settings.f_cloneData:TemplateUtils.cloneData;this.f_escapeString=this.settings.f_escapeString!==undefined?this.settings.f_escapeString:TemplateUtils.escapeHTML;this.f_parseJSON=this.settings.f_parseJSON!==undefined?this.settings.f_parseJSON:this.settings.disallow_functions?jQuery.parseJSON:TemplateUtils.parseJSON;if(e==null){return}this.splitTemplates(e,t);if(e){this.setTemplate(this._templates_code["MAIN"],t,this.settings)}this._templates_code=null};Template.version="0.8.4";Template.DEBUG_MODE=false;Template.FOREACH_LOOP_LIMIT=1e4;Template.guid=0;Template.prototype.splitTemplates=function(e,t){var n=/\{#template *(\w+) *(.*?) *\}/g,a,i,r,s=null,l=[],o;while((a=n.exec(e))!==null){s=n.lastIndex;i=a[1];r=e.indexOf("{#/template "+i+"}",s);if(r===-1){throw new Error('jTemplates: Template "'+i+'" is not closed.')}this._templates_code[i]=e.substring(s,r);l[i]=TemplateUtils.optionToObject(a[2])}if(s===null){this._templates_code["MAIN"]=e;return}for(o in this._templates_code){if(o!=="MAIN"){this._templates[o]=new Template}}for(o in this._templates_code){if(o!=="MAIN"){this._templates[o].setTemplate(this._templates_code[o],jQuery.extend({},t||{},this._templates||{}),jQuery.extend({},this.settings,l[o]));this._templates_code[o]=null}}};Template.prototype.setTemplate=function(e,t,n){if(e==undefined){this._tree.push(new TextNode("",1,this));return}e=e.replace(/[\n\r]/g,"");e=e.replace(/\{\*.*?\*\}/g,"");this._includes=jQuery.extend({},this._templates||{},t||{});this.settings=new Object(n);var a=this._tree,i=e.match(/\{#.*?\}/g),r=0,s=0,l,o=0,u,p;for(u=0,p=i?i.length:0;u<p;++u){var h=i[u];if(o){s=e.indexOf("{#/literal}",r);if(s===-1){throw new Error("jTemplates: No end of literal.")}if(s>r){a.push(new TextNode(e.substring(r,s),1,this))}r=s+11;o=0;while(u<p&&i[u]!=="{#/literal}"){u++}continue}s=e.indexOf(h,r);if(s>r){a.push(new TextNode(e.substring(r,s),o,this))}h.match(/\{#([\w\/]+).*?\}/);var c=RegExp.$1;switch(c){case"elseif":a.addCond(h);break;case"if":l=new opIF(a,this);l.addCond(h);a.push(l);a=l;break;case"else":a.switchToElse();break;case"/if":case"/for":case"/foreach":a=a.getParent();break;case"foreach":l=new opFOREACH(h,a,this);a.push(l);a=l;break;case"for":l=opFORFactory(h,a,this);a.push(l);a=l;break;case"continue":case"break":a.push(new JTException(c));break;case"include":a.push(new Include(h,this._includes,this));break;case"param":a.push(new UserParam(h,this));break;case"var":a.push(new UserVariable(h,this));break;case"cycle":a.push(new Cycle(h));break;case"ldelim":a.push(new TextNode("{",1,this));break;case"rdelim":a.push(new TextNode("}",1,this));break;case"literal":o=1;break;case"/literal":if(Template.DEBUG_MODE){throw new Error("jTemplates: Missing begin of literal.")}break;default:if(Template.DEBUG_MODE){throw new Error("jTemplates: unknown tag: "+c+".")}}r=s+h.length}if(e.length>r){a.push(new TextNode(e.substr(r),o,this))}};Template.prototype.get=function(e,t,n,a){++a;if(a==1&&n!=undefined){jQuery.removeData(n,"jTemplatesRef")}var i=e,r,s="";if(this.settings.clone_data){i=this.f_cloneData(e,{escapeData:this.settings.filter_data&&a==1,noFunc:this.settings.disallow_functions},this.f_escapeString)}if(!this.settings.clone_params){r=jQuery.extend({},this._param,t)}else{r=jQuery.extend({},this.f_cloneData(this._param,{escapeData:this.settings.filter_params,noFunc:false},this.f_escapeString),this.f_cloneData(t,{escapeData:this.settings.filter_params&&a==1,noFunc:false},this.f_escapeString))}for(var l=0,o=this._tree.length;l<o;++l){s+=this._tree[l].get(i,r,n,a)}this.EvalObj=null;--a;return s};Template.prototype.getBin=function(){if(this.EvalObj==null){this.EvalObj=new EvalClass(this)}return this.EvalObj};Template.prototype.setParam=function(e,t){this._param[e]=t};TemplateUtils=function(){};TemplateUtils.escapeHTML=function(e){return e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")};TemplateUtils.cloneData=function(e,t,n){if(e==null){return e}switch(e.constructor){case Object:var a={};for(var i in e){a[i]=TemplateUtils.cloneData(e[i],t,n)}if(!t.noFunc){if(e.hasOwnProperty("toString")){a.toString=e.toString}}return a;case Array:var r=[];for(var i=0,s=e.length;i<s;++i){r[i]=TemplateUtils.cloneData(e[i],t,n)}return r;case String:return t.escapeData?n(e):e;case Function:if(t.noFunc){if(Template.DEBUG_MODE){throw new Error("jTemplates: Functions are not allowed.")}else{return undefined}}}return e};TemplateUtils.optionToObject=function(e){if(e===null||e===undefined){return{}}var t=e.split(/[= ]/);if(t[0]===""){t.shift()}var n={};for(var a=0,i=t.length;a<i;a+=2){n[t[a]]=t[a+1]}return n};TemplateUtils.parseJSON=function(e){if(typeof e!=="string"||!e){return null}try{return new Function("return "+jQuery.trim(e))()}catch(t){if(Template.DEBUG_MODE){throw new Error("jTemplates: Invalid JSON")}return{}}};TemplateUtils.ReturnRefValue=function(e,t,n){while(e!=null){var a=jQuery.data(e,"jTemplatesRef");if(a!=undefined&&a.guid==t&&a.d[n]!=undefined){return a.d[n]}e=e.parentNode}return null};var TextNode=function(e,t,n){this._value=e;this._literalMode=t;this._template=n};TextNode.prototype.get=function(e,t,n,a){if(this._literalMode){return this._value}var i=this._value;var r="";var s=-1;var l=0;var o=-1;var u=0;while(true){var p=i.indexOf("{",s+1);var h=i.indexOf("}",s+1);if(p<0&&h<0){break}if(p!=-1&&p<h||h==-1){s=p;if(++l==1){o=p;r+=i.substring(u,s);u=-1}}else{s=h;if(--l===0){if(o>=0){r+=this._template.getBin().evaluateContent(e,t,n,i.substring(o,h+1));o=-1;u=s+1}}else if(l<0){l=0}}}if(u>-1){r+=i.substr(u)}return r};EvalClass=function(e){this.__templ=e};EvalClass.prototype.evaluateContent=function($T,$P,$Q,__value){try{var result=eval(__value);if(jQuery.isFunction(result)){if(this.__templ.settings.disallow_functions||!this.__templ.settings.runnable_functions){return""}result=result($T,$P,$Q)}return result===undefined?"":String(result)}catch(e){if(Template.DEBUG_MODE){if(e instanceof JTException){e.type="subtemplate"}throw e}return""}};EvalClass.prototype.evaluate=function($T,$P,$Q,__value){return eval(__value)};var opIF=function(e,t){this._parent=e;this._templ=t;this._cond=[];this._tree=[];this._curr=null};opIF.prototype.push=function(e){this._curr.push(e)};opIF.prototype.getParent=function(){return this._parent};opIF.prototype.addCond=function(e){e.match(/\{#(?:else)*if (.*?)\}/);this._cond.push(RegExp.$1);this._curr=[];this._tree.push(this._curr)};opIF.prototype.switchToElse=function(){this._cond.push(true);this._curr=[];this._tree.push(this._curr)};opIF.prototype.get=function(e,t,n,a){var i="";try{for(var r=0,s=this._cond.length;r<s;++r){if(this._templ.getBin().evaluate(e,t,n,this._cond[r])){var l=this._tree[r];for(var o=0,u=l.length;o<u;++o){i+=l[o].get(e,t,n,a)}return i}}}catch(p){if(Template.DEBUG_MODE||p instanceof JTException){throw p}}return i};opFORFactory=function(e,t,n){if(e.match(/\{#for (\w+?) *= *(\S+?) +to +(\S+?) *(?:step=(\S+?))*\}/)){var a=new opFOREACH(null,t,n);a._name=RegExp.$1;a._option={begin:RegExp.$2||0,end:RegExp.$3||-1,step:RegExp.$4||1,extData:"$T"};a._runFunc=function(e){return e};return a}else{throw new Error('jTemplates: Operator failed "find": '+e)}};var opFOREACH=function(e,t,n){this._parent=t;this._template=n;if(e!=null){e.match(/\{#foreach +(.+?) +as +(\w+?)( .+)*\}/);this._arg=RegExp.$1;this._name=RegExp.$2;this._option=RegExp.$3||null;this._option=TemplateUtils.optionToObject(this._option)}this._onTrue=[];this._onFalse=[];this._currentState=this._onTrue};opFOREACH.prototype.push=function(e){this._currentState.push(e)};opFOREACH.prototype.getParent=function(){return this._parent};opFOREACH.prototype.switchToElse=function(){this._currentState=this._onFalse};opFOREACH.prototype.get=function(e,t,n,a){try{var i=this._runFunc===undefined?this._template.getBin().evaluate(e,t,n,this._arg):this._runFunc;if(i===$){throw new Error("jTemplate: Variable '$' cannot be used as loop-function")}var r=[];var s=typeof i;if(s=="object"){var l=[];jQuery.each(i,function(e,t){r.push(e);l.push(t)});i=l}var o=this._option.extData!==undefined?this._template.getBin().evaluate(e,t,n,this._option.extData):e!=null?e:{};if(o==null){o={}}var u=Number(this._template.getBin().evaluate(e,t,n,this._option.begin)||0),p;var h=Number(this._template.getBin().evaluate(e,t,n,this._option.step)||1);if(s!="function"){p=i.length}else{if(this._option.end===undefined||this._option.end===null){p=Number.MAX_VALUE}else{p=Number(this._template.getBin().evaluate(e,t,n,this._option.end))+(h>0?1:-1)}}var c="";var f,_;if(this._option.count){var m=u+Number(this._template.getBin().evaluate(e,t,n,this._option.count));p=m>p?p:m}if(p>u&&h>0||p<u&&h<0){var d=0;var T=s!="function"?Math.ceil((p-u)/h):undefined;var g,y;var j=0;for(;h>0?u<p:u>p;u+=h,++d,++j){if(Template.DEBUG_MODE&&j>Template.FOREACH_LOOP_LIMIT){throw new Error("jTemplate: Foreach loop limit was exceed")}g=r[u];if(s!="function"){y=i[u]}else{y=i(u);if(y===undefined||y===null){break}}if(typeof y=="function"&&(this._template.settings.disallow_functions||!this._template.settings.runnable_functions)){continue}if(s=="object"&&g in Object&&y===Object[g]){continue}var v=o[this._name];o[this._name]=y;o[this._name+"$index"]=u;o[this._name+"$iteration"]=d;o[this._name+"$first"]=d===0;o[this._name+"$last"]=u+h>=p;o[this._name+"$total"]=T;o[this._name+"$key"]=g!==undefined&&g.constructor==String?this._template.f_escapeString(g):g;o[this._name+"$typeof"]=typeof y;for(f=0,_=this._onTrue.length;f<_;++f){try{c+=this._onTrue[f].get(o,t,n,a)}catch(E){if(E instanceof JTException){switch(E.type){case"continue":f=_;break;case"break":f=_;u=p;break;default:throw E}}else{throw E}}}delete o[this._name+"$index"];delete o[this._name+"$iteration"];delete o[this._name+"$first"];delete o[this._name+"$last"];delete o[this._name+"$total"];delete o[this._name+"$key"];delete o[this._name+"$typeof"];delete o[this._name];o[this._name]=v}}else{for(f=0,_=this._onFalse.length;f<_;++f){c+=this._onFalse[f].get(e,t,n,a)}}return c}catch(p){if(Template.DEBUG_MODE||p instanceof JTException){throw p}return""}};var JTException=function(e){this.type=e};JTException.prototype=Error;JTException.prototype.get=function(e){throw this};var Include=function(e,t,n){e.match(/\{#include (.*?)(?: root=(.*?))?\}/);this._template=t[RegExp.$1];if(this._template==undefined){if(Template.DEBUG_MODE){throw new Error("jTemplates: Cannot find include: "+RegExp.$1)}}this._root=RegExp.$2;this._mainTempl=n};Include.prototype.get=function(e,t,n,a){try{return this._template.get(this._mainTempl.getBin().evaluate(e,t,n,this._root),t,n,a)}catch(i){if(Template.DEBUG_MODE||i instanceof JTException){throw i}}return""};var UserParam=function(e,t){e.match(/\{#param name=(\w*?) value=(.*?)\}/);this._name=RegExp.$1;this._value=RegExp.$2;this._templ=t};UserParam.prototype.get=function(e,t,n,a){try{t[this._name]=this._templ.getBin().evaluate(e,t,n,this._value)}catch(i){if(Template.DEBUG_MODE||i instanceof JTException){throw i}t[this._name]=undefined}return""};var UserVariable=function(e,t){e.match(/\{#var (.*?)\}/);this._id=RegExp.$1;this._templ=t};UserVariable.prototype.get=function(e,t,n,a){try{if(n==undefined){return""}var i=this._templ.getBin().evaluate(e,t,n,this._id);var r=jQuery.data(n,"jTemplatesRef");if(r==undefined){r={guid:++Template.guid,d:[]}}var s=r.d.push(i);jQuery.data(n,"jTemplatesRef",r);return"(TemplateUtils.ReturnRefValue(this,"+r.guid+","+(s-1)+"))"}catch(l){if(Template.DEBUG_MODE||l instanceof JTException){throw l}return""}};var Cycle=function(oper){oper.match(/\{#cycle values=(.*?)\}/);this._values=eval(RegExp.$1);this._length=this._values.length;if(this._length<=0){throw new Error("jTemplates: no elements for cycle")}this._index=0;this._lastSessionID=-1};Cycle.prototype.get=function(e,t,n,a){var i=jQuery.data(n,"jTemplateSID");if(i!=this._lastSessionID){this._lastSessionID=i;this._index=0}var r=this._index++%this._length;return this._values[r]};jQuery.fn.setTemplate=function(e,t,n){return jQuery(this).each(function(){var a=e&&e.constructor==Template?e:new Template(e,t,n);jQuery.data(this,"jTemplate",a);jQuery.data(this,"jTemplateSID",0)})};jQuery.fn.setTemplateURL=function(e,t,n){var a=jQuery.ajax({url:e,dataType:"text",async:false,type:"GET"}).responseText;return jQuery(this).setTemplate(a,t,n)};jQuery.fn.setTemplateElement=function(e,t,n){var a=jQuery("#"+e).val();if(a==null){a=jQuery("#"+e).html();a=a.replace(/&lt;/g,"<").replace(/&gt;/g,">")}a=jQuery.trim(a);a=a.replace(/^<\!\[CDATA\[([\s\S]*)\]\]>$/im,"$1");a=a.replace(/^<\!--([\s\S]*)-->$/im,"$1");return jQuery(this).setTemplate(a,t,n)};jQuery.fn.hasTemplate=function(){var e=0;jQuery(this).each(function(){if(jQuery.getTemplate(this)){++e}});return e};jQuery.fn.removeTemplate=function(){jQuery(this).processTemplateStop();return jQuery(this).each(function(){jQuery.removeData(this,"jTemplate")})};jQuery.fn.setParam=function(e,t){return jQuery(this).each(function(){var n=jQuery.getTemplate(this);if(n!=null){n.setParam(e,t)}else if(Template.DEBUG_MODE){throw new Error("jTemplates: Template is not defined.")}})};jQuery.fn.processTemplate=function(e,t,n){return jQuery(this).each(function(){var a=jQuery.getTemplate(this);if(a!=null){if(n!=undefined&&n.StrToJSON){e=a.f_parseJSON(e)}jQuery.data(this,"jTemplateSID",jQuery.data(this,"jTemplateSID")+1);jQuery(this).html(a.get(e,t,this,0))}else if(Template.DEBUG_MODE){throw new Error("jTemplates: Template is not defined.")}})};jQuery.fn.processTemplateURL=function(e,t,n){var a=this;var i=jQuery.extend({cache:false},jQuery.ajaxSettings);i=jQuery.extend(i,n);jQuery.ajax({url:e,type:i.type,data:i.data,dataFilter:i.dataFilter,async:i.async,headers:i.headers,cache:i.cache,timeout:i.timeout,dataType:"text",success:function(e){var n=jQuery(a).processTemplate(e,t,{StrToJSON:true});if(i.on_success){i.on_success(n)}},error:i.on_error,complete:i.on_complete});return this};var Updater=function(e,t,n,a,i,r){this._url=e;this._param=t;this._interval=n;this._args=a;this.objs=i;this.timer=null;this._options=r||{};var s=this;jQuery(i).each(function(){jQuery.data(this,"jTemplateUpdater",s)});this.run()};Updater.prototype.run=function(){this.objs=jQuery.grep(this.objs,function(e){return jQuery.contains(document.body,e.jquery?e[0]:e)});if(this.objs.length===0){return}var e=this;jQuery.ajax({url:this._url,dataType:"text",data:this._args,cache:false,headers:e._options.headers,success:function(t){try{var n=jQuery(e.objs).processTemplate(t,e._param,{StrToJSON:true});if(e._options.on_success){e._options.on_success(n)}}catch(a){}}});this.timer=setTimeout(function(){e.run()},this._interval)};jQuery.fn.processTemplateStart=function(e,t,n,a,i){return new Updater(e,t,n,a,this,i)};jQuery.fn.processTemplateStop=function(){return jQuery(this).each(function(){var e=jQuery.data(this,"jTemplateUpdater");if(e==null){return}var t=this;e.objs=jQuery.grep(e.objs,function(e){return e!=t});jQuery.removeData(this,"jTemplateUpdater")})};jQuery.extend({createTemplate:function(e,t,n){return new Template(e,t,n)},createTemplateURL:function(e,t,n){var a=jQuery.ajax({url:e,dataType:"text",async:false,type:"GET"}).responseText;return new Template(a,t,n)},getTemplate:function(e){return jQuery.data(e,"jTemplate")},processTemplateToText:function(e,t,n){return e.get(t,n,undefined,0)},jTemplatesDebugMode:function(e){Template.DEBUG_MODE=e}})})(jQuery)}