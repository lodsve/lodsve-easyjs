(function($){$.fn.ajaxSubmit=function(options){if(typeof options=="function")options={success:options};options=$.extend({url:this.attr("action")||window.location,type:this.attr("method")||"GET"},options||{});var a=this.formToArray(options.semantic);if(options.beforeSubmit&&options.beforeSubmit(a,this,options)===false)return this;var veto={};$.event.trigger("form.submit.validate",[a,this,options,veto]);if(veto.veto)return this;var q=$.param(a);if(options.type.toUpperCase()=="GET"){options.url+=(options.url.indexOf("?")>=0?"&":"?")+q;options.data=null}else options.data=q;var $form=this,callbacks=[];if(options.resetForm)callbacks.push(function(){$form.resetForm()});if(options.clearForm)callbacks.push(function(){$form.clearForm()});if(!options.dataType&&options.target){var oldSuccess=options.success;callbacks.push(function(e){$(options.target).attr("innerHTML",e).evalScripts().each(oldSuccess,arguments)})}else if(options.success)callbacks.push(options.success);options.success=function(e,t){for(var o=0,n=callbacks.length;o<n;o++)callbacks[o](e,t,$form)};var files=$("input:file",this).fieldValue();var found=false;for(var j=0;j<files.length;j++)if(files[j])found=true;if(options.iframe||found)fileUpload();else $.ajax(options);$.event.trigger("form.submit.notify",[this,options]);return this;function fileUpload(){var form=$form[0];var opts=$.extend({},$.ajaxSettings,options);var id="jqFormIO"+$.fn.ajaxSubmit.counter++;var $io=$('<iframe id="'+id+'" name="'+id+'" />');var io=$io[0];var op8=$.browser.opera&&window.opera.version()<9;if($.browser.msie||op8)io.src='javascript:false;document.write("");';$io.css({position:"absolute",top:"-1000px",left:"-1000px"});var xhr={responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){}};var g=opts.global;if(g&&!$.active++)$.event.trigger("ajaxStart");if(g)$.event.trigger("ajaxSend",[xhr,opts]);var cbInvoked=0;var timedOut=0;setTimeout(function(){$io.appendTo("body");io.attachEvent?io.attachEvent("onload",cb):io.addEventListener("load",cb,false);var e=form.encoding?"encoding":"enctype";var t=$form.attr("target");$form.attr({target:id,method:"POST",encAttr:"multipart/form-data",action:opts.url});if(opts.timeout)setTimeout(function(){timedOut=true;cb()},opts.timeout);form.submit();$form.attr("target",t)},10);function cb(){if(cbInvoked++)return;io.detachEvent?io.detachEvent("onload",cb):io.removeEventListener("load",cb,false);var ok=true;try{if(timedOut)throw"timeout";var data,doc;doc=io.contentWindow?io.contentWindow.document:io.contentDocument?io.contentDocument:io.document;xhr.responseText=doc.body?doc.body.innerHTML:null;xhr.responseXML=doc.XMLDocument?doc.XMLDocument:doc;if(opts.dataType=="json"||opts.dataType=="script"){var ta=doc.getElementsByTagName("textarea")[0];data=ta?ta.value:xhr.responseText;if(opts.dataType=="json")eval("data = "+data);else $.globalEval(data)}else if(opts.dataType=="xml"){data=xhr.responseXML;if(!data&&xhr.responseText!=null)data=toXml(xhr.responseText)}else{data=xhr.responseText}}catch(e){ok=false;$.handleError(opts,xhr,"error",e)}if(ok){opts.success(data,"success");if(g)$.event.trigger("ajaxSuccess",[xhr,opts])}if(g)$.event.trigger("ajaxComplete",[xhr,opts]);if(g&&!--$.active)$.event.trigger("ajaxStop");if(opts.complete)opts.complete(xhr,ok?"success":"error");setTimeout(function(){$io.remove();xhr.responseXML=null},100)}function toXml(e,t){if(window.ActiveXObject){t=new ActiveXObject("Microsoft.XMLDOM");t.async="false";t.loadXML(e)}else t=(new DOMParser).parseFromString(e,"text/xml");return t&&t.documentElement&&t.documentElement.tagName!="parsererror"?t:null}}};$.fn.ajaxSubmit.counter=0;$.fn.ajaxForm=function(e){return this.ajaxFormUnbind().submit(submitHandler).each(function(){this.formPluginId=$.fn.ajaxForm.counter++;$.fn.ajaxForm.optionHash[this.formPluginId]=e;$(":submit,input:image",this).click(clickHandler)})};$.fn.ajaxForm.counter=1;$.fn.ajaxForm.optionHash={};function clickHandler(e){var t=this.form;t.clk=this;if(this.type=="image"){if(e.offsetX!=undefined){t.clk_x=e.offsetX;t.clk_y=e.offsetY}else if(typeof $.fn.offset=="function"){var o=$(this).offset();t.clk_x=e.pageX-o.left;t.clk_y=e.pageY-o.top}else{t.clk_x=e.pageX-this.offsetLeft;t.clk_y=e.pageY-this.offsetTop}}setTimeout(function(){t.clk=t.clk_x=t.clk_y=null},10)}function submitHandler(){var e=this.formPluginId;var t=$.fn.ajaxForm.optionHash[e];$(this).ajaxSubmit(t);return false}$.fn.ajaxFormUnbind=function(){this.unbind("submit",submitHandler);return this.each(function(){$(":submit,input:image",this).unbind("click",clickHandler)})};$.fn.formToArray=function(e){var t=[];if(this.length==0)return t;var o=this[0];var n=e?o.getElementsByTagName("*"):o.elements;if(!n)return t;for(var a=0,r=n.length;a<r;a++){var i=n[a];var s=i.name;if(!s)continue;if(e&&o.clk&&i.type=="image"){if(!i.disabled&&o.clk==i)t.push({name:s+".x",value:o.clk_x},{name:s+".y",value:o.clk_y});continue}var c=$.fieldValue(i,true);if(c&&c.constructor==Array){for(var f=0,l=c.length;f<l;f++)t.push({name:s,value:c[f]})}else if(c!==null&&typeof c!="undefined")t.push({name:s,value:c})}if(!e&&o.clk){var u=o.getElementsByTagName("input");for(var a=0,r=u.length;a<r;a++){var p=u[a];var s=p.name;if(s&&!p.disabled&&p.type=="image"&&o.clk==p)t.push({name:s+".x",value:o.clk_x},{name:s+".y",value:o.clk_y})}}return t};$.fn.formSerialize=function(e){return $.param(this.formToArray(e))};$.fn.fieldSerialize=function(e){var t=[];this.each(function(){var o=this.name;if(!o)return;var n=$.fieldValue(this,e);if(n&&n.constructor==Array){for(var a=0,r=n.length;a<r;a++)t.push({name:o,value:n[a]})}else if(n!==null&&typeof n!="undefined")t.push({name:this.name,value:n})});return $.param(t)};$.fn.fieldValue=function(e){for(var t=[],o=0,n=this.length;o<n;o++){var a=this[o];var r=$.fieldValue(a,e);if(r===null||typeof r=="undefined"||r.constructor==Array&&!r.length)continue;r.constructor==Array?$.merge(t,r):t.push(r)}return t};$.fieldValue=function(e,t){var o=e.name,n=e.type,a=e.tagName.toLowerCase();if(typeof t=="undefined")t=true;if(t&&(!o||e.disabled||n=="reset"||n=="button"||(n=="checkbox"||n=="radio")&&!e.checked||(n=="submit"||n=="image")&&e.form&&e.form.clk!=e||a=="select"&&e.selectedIndex==-1))return null;if(a=="select"){var r=e.selectedIndex;if(r<0)return null;var i=[],s=e.options;var c=n=="select-one";var f=c?r+1:s.length;for(var l=c?r:0;l<f;l++){var u=s[l];if(u.selected){var p=$.browser.msie&&!u.attributes["value"].specified?u.text:u.value;if(c)return p;i.push(p)}}return i}return e.value};$.fn.clearForm=function(){return this.each(function(){$("input,select,textarea",this).clearFields()})};$.fn.clearFields=$.fn.clearInputs=function(){return this.each(function(){var e=this.type,t=this.tagName.toLowerCase();if(e=="text"||e=="password"||t=="textarea")this.value="";else if(e=="checkbox"||e=="radio")this.checked=false;else if(t=="select")this.selectedIndex=-1})};$.fn.resetForm=function(){return this.each(function(){if(typeof this.reset=="function"||typeof this.reset=="object"&&!this.reset.nodeType)this.reset()})}})(jQuery);