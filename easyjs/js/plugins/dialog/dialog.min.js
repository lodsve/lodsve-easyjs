var ligerDialogImagePath=easyloader.URI+"/js/plugins/"+(easyloader.theme=="default"?"aqua":easyloader.theme)+"/images/dialog/";(function($){$.ligerDefaults=$.ligerDefaults||{};$.ligerDefaults.Dialog={className:"l-dialog",opacity:.5,cls:null,id:null,buttons:null,isDrag:true,width:280,height:null,content:"",target:null,url:null,load:false,type:"none",left:null,top:null,modal:true,name:null,isResize:false,allowClose:true,opener:null,timeParmName:null,closeWhenEnter:null,isNeedNoPaddingClass:false,completeFunction:null,scroll:false};$.ligerDefaults.DialogString={titleMessage:"提示",waittingMessage:"正在等待中,请稍候..."};$.ligerDialog={};$.ligerDialog.open=function(e){e=$.extend({},$.ligerDefaults.Dialog,$.ligerDefaults.DialogString,e||{});var l={enter:function(){var i;if(e.closeWhenEnter!=undefined){i=e.closeWhenEnter}else if(e.type=="warn"||e.type=="error"||e.type=="success"||e.type=="question"){i=true}if(i){l.dialog.close()}},esc:function(){l.dialog.close()},applyWindowMask:function(){var l=$("<div class='l-window-mask' style='display: block;'></div>").height($(window).height()+$(window).scrollTop());var i=$(".l-dialog:last").css("z-index");var t=$(".l-dialog").eq(-2).css("z-index");if(i&&t){l.css("z-index",(Number(i)+Number(t))/2)}l.appendTo("body");$(l).css("opacity",e.opacity)},removeWindowMask:function(){$(".l-window-mask:last").remove()},applyDrag:function(){if($.fn.ligerDrag)l.dialog.ligerDrag({handler:".l-dialog-title"})},applyResize:function(){if($.fn.ligerResizable){l.dialog.ligerResizable({onStopResize:function(e,i){var t=0;var o=0;if(!isNaN(parseInt(l.dialog.css("top"))))t=parseInt(l.dialog.css("top"));if(!isNaN(parseInt(l.dialog.css("left"))))o=parseInt(l.dialog.css("left"));if(e.diffTop!=undefined){l.dialog.css({top:t+e.diffTop,left:o+e.diffLeft});l.dialog.body.css({width:e.newWidth-26});$(".l-dialog-content",l.dialog.body).height(e.newHeight-46-$(".l-dialog-buttons",l.dialog).height())}return false}})}},setImage:function(){if(e.type){if(e.type=="success"||e.type=="donne"||e.type=="ok"){$(".l-dialog-image",l.dialog).addClass("l-dialog-image-donne").show();$(".l-dialog-content",l.dialog).css({paddingLeft:64,paddingBottom:30})}else if(e.type=="error"){$(".l-dialog-image",l.dialog).addClass("l-dialog-image-error").show();$(".l-dialog-content",l.dialog).css({paddingLeft:64,paddingBottom:30})}else if(e.type=="warn"){$(".l-dialog-image",l.dialog).addClass("l-dialog-image-warn").show();$(".l-dialog-content",l.dialog).css({paddingLeft:64,paddingBottom:30})}else if(e.type=="question"){$(".l-dialog-image",l.dialog).addClass("l-dialog-image-question").show();$(".l-dialog-content",l.dialog).css({paddingLeft:64,paddingBottom:40})}}}};l.dialog=$("<div class="+e.className+'><table class="l-dialog-table" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td class="l-dialog-tl"></td><td class="l-dialog-tc"><div class="l-dialog-tc-inner"><div class="l-dialog-icon"></div><div class="l-dialog-title"></div><div class="l-dialog-close"></div></div></td><td class="l-dialog-tr"></td></tr><tr><td class="l-dialog-cl"></td><td class="l-dialog-cc"><div class="l-dialog-body"><div class="l-dialog-image"></div> <div class="l-dialog-content"></div><div class="l-dialog-buttons"><div class="l-dialog-buttons-inner"></div></td><td class="l-dialog-cr"></td></tr><tr><td class="l-dialog-bl"></td><td class="l-dialog-bc"></td><td class="l-dialog-br"></td></tr></tbody></table></div>');var i=$(".l-dialog:last").css("z-index");$("body").append(l.dialog);l.dialog.css("z-index",Number(i)+10);l.dialog.body=$(".l-dialog-body:first",l.dialog);l.dialog.close=function(){if(l.dialog.frame){$(l.dialog.frame.document).ready(function(){l.removeWindowMask();l.dialog.remove()})}else{l.removeWindowMask();l.dialog.remove()}$("body").unbind("keydown.dialog")};l.dialog.doShow=function(){l.dialog.show();if(e.completeFunction)e.completeFunction()};if(e.allowClose==false)$(".l-dialog-close",l.dialog).remove();if(e.target||e.url||e.type=="none")e.type=null;if(e.cls)l.dialog.addClass(e.cls);if(e.id)l.dialog.attr("id",e.id);if(e.modal)l.applyWindowMask();if(e.isDrag)l.applyDrag();if(e.isResize)l.applyResize();if(e.type)l.setImage();else{$(".l-dialog-image",l.dialog).remove();$(".l-dialog-content",l.dialog.body).addClass("l-dialog-content-noimage")}if(e.target){$(".l-dialog-content",l.dialog.body).prepend(e.target)}else if(e.url){if(e.timeParmName){e.url+=e.url.indexOf("?")==-1?"?":"&";e.url+=e.timeParmName+"="+(new Date).getTime()}var t=$("<iframe frameborder='0'></iframe>");var o=e.name?e.name:"ligerwindow"+(new Date).getTime();if(e.scroll){t.attr("scrolling","yes")}else{t.attr("scrolling","no")}t.attr("name",o);t.attr("id",o);$(".l-dialog-content",l.dialog.body).prepend(t);$(".l-dialog-content",l.dialog.body).addClass("l-dialog-content-nopadding");setTimeout(function(){t.attr("src",e.url);l.dialog.frame=window.frames[t.attr("name")]},0)}else if(e.content){$(".l-dialog-content",l.dialog.body).html(e.content);if(e.isNeedNoPaddingClass&&typeof e.isNeedNoPaddingClass=="boolean"){$(".l-dialog-content",l.dialog.body).addClass("l-dialog-content-nopadding")}}if(e.opener)l.dialog.opener=e.opener;if(e.buttons){$(e.buttons).each(function(e,i){var t=$('<div class="l-dialog-btn"><div class="l-dialog-btn-l"></div><div class="l-dialog-btn-r"></div><div class="l-dialog-btn-inner"></div></div>');$(".l-dialog-btn-inner",t).html(i.text);$(".l-dialog-buttons-inner",l.dialog.body).prepend(t);i.width&&t.width(i.width);i.className&&t.addClass(i.className);i.onclick&&t.click(function(){i.onclick(i,l.dialog,e)})})}else{$(".l-dialog-buttons",l.dialog).remove()}$(".l-dialog-buttons-inner",l.dialog).append("<div class='l-clear'></div>");e.width&&l.dialog.body.width(e.width-26);if(e.height){$(".l-dialog-content",l.dialog.body).height(e.height-46-$(".l-dialog-buttons",l.dialog).height())}e.title=e.title||e.titleMessage;e.title&&$(".l-dialog-title",l.dialog).html(e.title);$(".l-dialog-title",l.dialog).bind("selectstart",function(){return false});$(".l-dialog-btn",l.dialog.body).hover(function(){$(this).addClass("l-dialog-btn-over")},function(){$(this).removeClass("l-dialog-btn-over")});$(".l-dialog-tc .l-dialog-close",l.dialog).hover(function(){$(this).addClass("l-dialog-close-over")},function(){$(this).removeClass("l-dialog-close-over")}).click(function(){l.dialog.close()});var a=navigator.appName=="Microsoft Internet Explorer"&&parseInt(navigator.appVersion)==4&&navigator.appVersion.indexOf("MSIE 5.5")!=-1;var r=navigator.appName=="Microsoft Internet Explorer"&&parseInt(navigator.appVersion)==4&&navigator.appVersion.indexOf("MSIE 6.0")!=-1;if($.browser.msie&&(a||r)){$(".l-dialog-tl:first",l.dialog).css({background:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+ligerDialogImagePath+"dialog-tl.png',sizingMethod='crop');"});$(".l-dialog-tc:first",l.dialog).css({background:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+ligerDialogImagePath+"ie6/dialog-tc.png',sizingMethod='crop');"});$(".l-dialog-tr:first",l.dialog).css({background:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+ligerDialogImagePath+"dialog-tr.png',sizingMethod='crop');"});$(".l-dialog-cl:first",l.dialog).css({background:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+ligerDialogImagePath+"ie6/dialog-cl.png',sizingMethod='crop');"});$(".l-dialog-cr:first",l.dialog).css({background:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+ligerDialogImagePath+"ie6/dialog-cr.png',sizingMethod='crop');"});$(".l-dialog-bl:first",l.dialog).css({background:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+ligerDialogImagePath+"dialog-bl.png',sizingMethod='crop');"});$(".l-dialog-bc:first",l.dialog).css({background:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+ligerDialogImagePath+"ie6/dialog-bc.png',sizingMethod='crop');"});$(".l-dialog-br:first",l.dialog).css({background:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+ligerDialogImagePath+"dialog-br.png',sizingMethod='crop');"})}var n=0;var s=0;var d=e.width||l.dialog.width();if(e.left!=null)n=e.left;else n=.5*($(window).width()-d);if(e.top!=null)s=e.top;else s=.5*($(window).height()-l.dialog.height())+$(window).scrollTop()-10;l.dialog.css({left:n,top:s});l.dialog.doShow();$("#l-dialog").focus();$("body").bind("keydown.dialog",function(e){var i=e.which;if(i==13){l.enter()}else if(i==27){l.esc()}});return l.dialog};$.ligerDialog.close=function(){$(".l-dialog,.l-window-mask").remove()};$.ligerDialog.alert=function(e,l,i,t,o){e=e||"";if(typeof l=="function"){o=l;i=null}else if(typeof i=="function"){o=i}else if(typeof t=="function"){o=t}var a=function(e,l,i){l.close();if(o)o(e,l,i)};p={className:t&&typeof t=="string"?t:$.ligerDefaults.Dialog.className,content:e,buttons:[{text:"确定",onclick:a}]};if(typeof l=="string"&&l!="")p.title=l;if(typeof i=="string"&&i!="")p.type=i;$.ligerDialog.open(p)};$.ligerDialog.confirm=function(e,l,i,t,o){var t=i&&typeof i=="string"?i:t&&typeof(t=="string")?t:$.ligerDefaults.Dialog.className;if(typeof l=="function"){i=l;o=null}var a=function(e,l){l.close();if(i){i(e.type=="ok")}};p={opacity:$.ligerDialog.defaultProps.opacity,className:t,type:o&&typeof o=="string"?o:"question",content:e,buttons:[{text:"是",onclick:a,type:"ok"},{text:"否",onclick:a,type:"no"}]};if(typeof l=="string"&&l!="")p.title=l;$.ligerDialog.open(p)};$.ligerDialog.warning=function(e,l,i){if(typeof l=="function"){i=l;type=null}var t=function(e,l){l.close();if(i){i(e.type)}};p={type:"question",content:e,buttons:[{text:"是",onclick:t,type:"yes"},{text:"否",onclick:t,type:"no"},{text:"取消",onclick:t,type:"cancel"}]};if(typeof l=="string"&&l!="")p.title=l;$.ligerDialog.open(p)};$.ligerDialog.waitting=function(e,l){e=e||$.ligerDefaults.Dialog.waittingMessage;$.ligerDialog.open({cls:"l-dialog-waittingdialog",type:"none",content:'<div style="padding:4px">'+e+"</div>",allowClose:false});setTimeout($.ligerDialog.closeWaitting,l?l:2e3)};$.ligerDialog.closeWaitting=function(){$(".l-dialog-waittingdialog,.l-window-mask:last").remove()};$.ligerDialog.success=function(e,l,i,t){$.ligerDialog.alert(e,l,"success",i,t)};$.ligerDialog.error=function(e,l,i,t){$.ligerDialog.alert(e,l,"error",i,t)};$.ligerDialog.warn=function(e,l,i,t){$.ligerDialog.alert(e,l,"warn",i,t)};$.ligerDialog.question=function(e,l,i){$.ligerDialog.alert(e,l,"question",i)};$.ligerDialog.prompt=function(e,l,i,t){var o=$('<input type="text" class="l-dialog-inputtext"/>');if(typeof i=="function"){t=i}if(typeof l=="function"){t=l}else if(typeof l=="boolean"){i=l}if(typeof i=="boolean"&&i){o=$('<textarea class="l-dialog-textarea"></textarea>')}if(typeof l=="string"||typeof l=="int"){o.val(l)}var a=function(e,l,i){l.close();if(t){t(e.type=="yes",o.val())}};p={title:e,target:o,width:320,buttons:[{text:"确定",onclick:a,type:"yes"},{text:"取消",onclick:a,type:"cancel"}]};$.ligerDialog.open(p)};$.ligerDialog.defaultProps={opacity:.5,backColor:"#ffffd7",delay:1e3,borderWidth:1,borderStyle:"solid",borderColor:"#ccc",tips:"操作成功！",content:"确定要删除吗？",btnSure:"确定",btnCancel:"取消",formUrl:null,submitUrl:null,redirectUrl:null,formId:"form1",isNeedFormValid:true};$.ligerDialog.confirmDelete=function(p){var cp=$.extend({},$.ligerDefaults.Dialog,$.ligerDefaults.DialogString,p||{});var elObj=$(cp.elObj);var btnclick=function(item,Dialog){Dialog.close();if(elObj&&item.type=="ok"){var returnValue;$.ajax({type:"post",url:elObj.attr("url")?elObj.attr("url"):cp.submitUrl?cp.submitUrl:$.ligerDialog.defaultProps.submitUrl,data:elObj.attr("data")?elObj.attr("data"):"",success:function(ret){var tip_style="padding:5px;background:"+(cp.disBackColor?cp.disBackColor:$.ligerDialog.defaultProps.backColor)+";border:"+(cp.borderWidth?cp.borderWidth:$.ligerDialog.defaultProps.borderWidth)+"px "+(cp.borderStyle?cp.borderStyle:$.ligerDialog.defaultProps.borderStyle)+" "+(cp.borderColor?cp.borderColor:$.ligerDialog.defaultProps.borderColor);returnValue=$.trim(ret);try{returnValue=eval("("+returnValue+")");if(returnValue.status==1){if(cp.showAlert)$.ligerDialog.alert(cp.tips?cp.tips:$.ligerDialog.defaultProps.tips,"提示","success",function(){if(cp.completeFunction)cp.completeFunction()});else{elObj.html("<div style='"+tip_style+"'>"+(cp.tips?cp.tips:$.ligerDialog.defaultProps.tips)+"</div>");elObj.fadeOut(cp.delayMillions?cp.delayMillions:$.ligerDialog.defaultProps.delay)}}else{$.ligerDialog.alert(returnValue.msg,"提示","warn")}}catch(e){}},error:function(e,l){if(l=="error")$.ligerDialog.alert("出错啦！","出错提示","warn")}})}};var content=cp.content?cp.content:$.ligerDialog.defaultProps.content;if(cp.contentUrl){content="<iframe frameborder='0' src='"+cp.contentUrl+"' width='100%' height='100%'></iframe>"}p={type:cp.showIconType&&typeof cp.showIconType=="string"?cp.showIconType:"question",content:content,width:cp.width?cp.width:280,height:cp.height?cp.height:null,buttons:[{text:"是",onclick:btnclick,type:"ok"},{text:"否",onclick:btnclick,type:"no"}]};if(typeof cp.title=="string"&&cp.title!="")p.title=cp.title;$.ligerDialog.open(p)};$.ligerDialog.ajaxFormSubmit=function(e){var e=e;if(e.opacity!="undefined"){$.ligerDefaults.Dialog.opacity=e.opacity}else{$.ligerDefaults.Dialog.opacity=$.ligerDefaults.DialogString.opacity}$.ligerDialog.open({className:e.className?e.className:$.ligerDefaults.Dialog.className,title:e.title?e.title:"提示",url:e.formUrl?e.formUrl:$.ligerDialog.defaultProps.formUrl,width:e.width?e.width:$.ligerDefaults.Dialog.width,height:e.height?e.height:$.ligerDefaults.Dialog.height,scroll:e.scroll?e.scroll:false,buttons:[{text:e.btnSure?e.btnSure:$.ligerDialog.defaultProps.btnSure,className:"l-button-yes",onclick:function(l,i){var t=$(".l-dialog-btn:last",i);if(t.hasClass("l-dialog-btn-disable")){return}if(e.beforeSubmit&&typeof e.beforeSubmit=="function"){if(e.beforeSubmit(e,i)==false){return false}}var o=$(i.frame.document).find("#"+(e.formId?e.formId:$.ligerDialog.defaultProps.formId));var a;if(o){var r=e.isNeedFormValid!="undefined"&&typeof e.isNeedFormValid=="boolean"?e.isNeedFormValid:$.ligerDialog.defaultProps.isNeedFormValid;var n=true;if(r)n=i.frame.$.validationEngine.doValidate("#"+e.formId);if(n){t.addClass("l-dialog-btn-disable");$(".l-dialog-btn-inner",t).html("提交中...");o.ajaxSubmit({type:"post",url:e.submitUrl?e.submitUrl:$.ligerDialog.defaultProps.submitUrl,resetForm:e.isFormReset?e.isFormReset:false,data:e.data?e.data:"",success:function(l){t.removeClass("l-dialog-btn-disable");$(".l-dialog-btn-inner",t).html(e.btnSure?e.btnSure:$.ligerDialog.defaultProps.btnSure);try{a=$.util.decode(l);var o=a.msg&&a.msg!=null?a.msg:a.status==1?"保存成功！":"保存失败！";if(!e.submitSuccessFunc){if(a.status==1){if(e.redirectUrl){$.ligerDialog.alert(o,"提示","success",function(){if(e.tabObj){e.tabObj.location(e.tabObj.getSelectedTabItemID(),e.redirectUrl)}else{top.location=e.redirectUrl}})}else{i.close();$.ligerDialog.alert(o,"提示","success",function(){if(e.tabObj){e.tabObj.reload(e.tabObj.getSelectedTabItemID())}})}}else if(a.status==0){$.ligerDialog.error(o)}else{$.ligerDialog.warn(o)}}else{if(typeof e.submitSuccessFunc=="function")e.submitSuccessFunc($.trim(l),i)}}catch(r){alert("解析错误"+r.description)}},error:function(e,l){$.ligerDialog.error("错误！可能原因：参数配置错误、响应出现异常。")}})}}else $.ligerDialog.warn("表单不存在！")}},{text:e.btnCancel?e.btnCancel:$.ligerDialog.defaultProps.btnCancel,onclick:function(e,l){l.close()}}]})};$.ligerDialog.ajaxRequest=function(e){var e=e;if(!e.showDialog){$.ajax({type:"post",url:e.submitUrl?e.submitUrl:$.ligerDialog.defaultProps.submitUrl,data:e.data?e.data:null,success:function(l){if(!e.successFunc){}else{if(typeof e.successFunc=="function"){}}}})}else{$.ligerDialog.open({title:e.title?e.title:"确定要执行？"})}};$.ligerDialog.postComment=function(p){var cms_list="cms_list";var p=p;if(!p.contentId||!p.url)return;var content=$("#"+p.contentId).val();if(!content&&""==content){$("#"+p.contentId).focus();return}var returnValue;$.ajax({type:"post",url:p.url?p.url:"",data:p.data?p.data:"",success:function(ret){returnValue=$.trim(ret);try{returnValue=eval("("+returnValue+")");if(returnValue.status==1){$.ligerDialog.alert(returnValue.msg,"提示","success",function(){$("#"+p.contentId).val("");var e=$("#"+p.parentElement+" ."+cms_list+" li").first();$("#"+p.parentElement+" ."+cms_list+" li").first().before(returnValue.htmlStr);$("#"+p.parentElement+" ."+cms_list+" li").first().hide();$("#"+p.parentElement+" ."+cms_list+" li").first().fadeIn(1e3)})}}catch(e){}},error:function(e,l){alert(l)}})};$.ligerDialog.submit=function(formId,submitUrl,dialog,p){var returnValue;if(p&&p.beforeSubmit&&typeof p.beforeSubmit=="function"){if(p.beforeSubmit()==false){return false}}$(dialog.frame.document).find("#"+formId).ajaxSubmit({type:"post",url:submitUrl,success:function(ret){returnValue=$.trim(ret);try{returnValue=eval("("+returnValue+")");var msg=returnValue.msg&&returnValue.msg!=null?returnValue.msg:returnValue.status==1?"保存成功！":"保存失败！";if(returnValue.status==1){top.$.ligerDialog.alert(msg,"提示","success",function(){})}else{top.$.ligerDialog.alert(msg,"提示","error")}}catch(e){}},error:function(e,l){if(l=="error")$.ligerDialog.alert("出错啦！","出错提示","warn")}})};window.dialog=$.ligerDialog})(jQuery);