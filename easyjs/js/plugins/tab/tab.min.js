if(typeof LigerUIManagers=="undefined")LigerUIManagers={};(function(t){t.fn.ligerGetTabManager=function(){return LigerUIManagers[this[0].id+"_Tab"]};t.ligerDefaults=t.ligerDefaults||{};t.ligerDefaults.Tab={height:null,heightDiff:0,changeHeightOnResize:false,contextmenu:false,closeMessage:"关闭当前页",closeOtherMessage:"关闭其他",closeAllMessage:"关闭所有",reloadMessage:"刷新",onBeforeOverrideTabItem:null,onAfterOverrideTabItem:null,onBeforeRemoveTabItem:null,onAfterRemoveTabItem:null,onBeforeAddTabItem:null,onAfterAddTabItem:null,onBeforeSelectTabItem:null,onAfterSelectTabItem:null,isVerticalTab:false};t.fn.ligerTab=function(e){e=t.extend({},t.ligerDefaults.Tab,e||{});this.each(function(){if(this.usedTab)return;if(t(this).hasClass("l-hidden")){return}var a={setTabButton:function(){var e=0;t("li",a.tab.links.ul).each(function(){e+=t(this).width()+2});var i=a.tab.width();if(e>i){a.tab.links.append('<div class="l-tab-links-left"></div><div class="l-tab-links-right"></div>');a.setTabButtonEven();return true}else{a.tab.links.ul.animate({left:0});t(".l-tab-links-left,.l-tab-links-right",a.tab.links).remove();return false}},setTabButtonEven:function(){t(".l-tab-links-left",a.tab.links).hover(function(){t(this).addClass("l-tab-links-left-over")},function(){t(this).removeClass("l-tab-links-left-over")}).click(function(){a.moveToPrevTabItem()});t(".l-tab-links-right",a.tab.links).hover(function(){t(this).addClass("l-tab-links-right-over")},function(){t(this).removeClass("l-tab-links-right-over")}).click(function(){a.moveToNextTabItem()})},moveToPrevTabItem:function(){var e=t(".l-tab-links-left",a.tab.links).width();var i=new Array;t("li",a.tab.links).each(function(a,n){var l=-1*e;if(a>0){l=parseInt(i[a-1])+t(this).prev().width()+2}i.push(l)});var n=-1*parseInt(a.tab.links.ul.css("left"));for(var l=0;l<i.length-1;l++){if(i[l]<n&&i[l+1]>=n){a.tab.links.ul.animate({left:-1*parseInt(i[l])});return}}},moveToNextTabItem:function(){var e=t(".l-tab-links-right",a.tab).width();var i=0;var n=t("li",a.tab.links.ul);n.each(function(){i+=t(this).width()+2});var l=a.tab.width();var s=new Array;for(var r=n.length-1;r>=0;r--){var o=i-l+e+2;if(r!=n.length-1){o=parseInt(s[n.length-2-r])-t(n[r+1]).width()-2}s.push(o)}var b=-1*parseInt(a.tab.links.ul.css("left"));for(var r=1;r<s.length;r++){if(s[r]<=b&&s[r-1]>b){a.tab.links.ul.animate({left:-1*parseInt(s[r-1])});return}}},getTabItemCount:function(){return t("li",a.tab.links.ul).length},getSelectedTabItemID:function(){return t("li.l-selected",a.tab.links.ul).attr("tabid")},removeSelectedTabItem:function(){a.removeTabItem(a.getSelectedTabItemID())},overrideSelectedTabItem:function(t){a.overrideTabItem(a.getSelectedTabItemID(),t)},overrideTabItem:function(i,n){if(e.onBeforeOverrideTabItem&&e.onBeforeOverrideTabItem(i)==false)return false;var l=n.tabid;if(l==undefined)l=a.getNewTabid();var s=n.url;var r=n.content;var o=n.target;var b=n.text;var c=n.showClose;var f=n.height;if(a.isTabItemExist(l)){return}var d=t("li[tabid="+i+"]",a.tab.links.ul);var h=t(".l-tab-content-item[tabid="+i+"]",a.tab.content);if(!d||!h)return;d.attr("tabid",l);h.attr("tabid",l);if(t("iframe",h).length==0&&s){h.html("<iframe frameborder='0'></iframe>")}else if(r){h.html(r)}t("iframe",h).attr("name",l);if(c==undefined)c=true;if(c==false)t(".l-tab-links-item-close",d).remove();else{if(t(".l-tab-links-item-close",d).length==0)d.append("<div class='l-tab-links-item-close'></div>")}if(b==undefined)b=l;if(f)h.height(f);t("a",d).text(b);t("iframe",h).attr("src",s);e.onAfterOverrideTabItem&&e.onAfterOverrideTabItem(i)},selectTabItem:function(i){t(".formError").remove();if(e.onBeforeSelectTabItem&&e.onBeforeSelectTabItem(i)==false)return false;a.selectedTabId=i;t("> .l-tab-content-item[tabid="+i+"]",a.tab.content).show().siblings().hide();t("li[tabid="+i+"]",a.tab.links.ul).addClass("l-selected").siblings().removeClass("l-selected");e.onAfterSelectTabItem&&e.onAfterSelectTabItem(i)},moveToLastTabItem:function(){var e=0;t("li",a.tab.links.ul).each(function(){e+=t(this).width()+2});var i=a.tab.width();if(e>i){var n=t(".l-tab-links-right",a.tab.links).width();a.tab.links.ul.animate({left:-1*(e-i+n+2)})}},isTabItemExist:function(e){return t("li[tabid="+e+"]",a.tab.links.ul).length>0},addTabItem:function(i){if(e.onBeforeAddTabItem&&e.onBeforeAddTabItem(n)==false)return false;var n=i.tabid;if(n==undefined)n=a.getNewTabid();var l=i.url;var s=i.content;var r=i.text;var o=i.showClose;var b=i.height;var c=false;if(a.isTabItemExist(n)){a.selectTabItem(n);return}var f=t("<li><div class='maintab_left'><a></a></div><div class='maintab_right'><div class='l-tab-links-item-close'></div></div></li>");var d=t("<div class='l-tab-content-item'><iframe frameborder='0'></iframe></div>");if(a.makeFullHeight){var h=a.tab.height()-a.tab.links.height();d.height(h)}f.attr("tabid",n);d.attr("tabid",n);t("iframe",d).attr("name",n);if(o==undefined)o=true;if(o==false)t(".l-tab-links-item-close",f).remove();if(r==undefined)r=n;if(b)d.height(b);t("a",f).text(r);t("iframe",d).attr("src",l);a.tab.links.ul.append(f);a.tab.content.append(d);a.selectTabItem(n);if(a.setTabButton()){a.moveToLastTabItem()}a.addTabItemEvent(f);e.onAfterAddTabItem&&e.onAfterAddTabItem(n)},addTabItemEvent:function(e){e.click(function(){var e=t(this).attr("tabid");a.selectTabItem(e)});a.tab.menu&&i.addTabItemContextMenuEven(e);t(".l-tab-links-item-close",e).hover(function(){t(this).addClass("l-tab-links-item-close-over")},function(){t(this).removeClass("l-tab-links-item-close-over")}).click(function(){var e=t(this).parent().parent().attr("tabid");a.removeTabItem(e)})},removeTabItem:function(i){if(e.onBeforeRemoveTabItem&&e.onBeforeRemoveTabItem(i)==false)return false;var n=t("li[tabid="+i+"]",a.tab.links.ul).hasClass("l-selected");if(n){t(".l-tab-content-item[tabid="+i+"]",a.tab.content).prev().show();t("li[tabid="+i+"]",a.tab.links.ul).prev().addClass("l-selected").siblings().removeClass("l-selected")}t(".l-tab-content-item[tabid="+i+"]",a.tab.content).remove();t("li[tabid="+i+"]",a.tab.links.ul).remove();a.setTabButton();e.onAfterRemoveTabItem&&e.onAfterRemoveTabItem(i)},addHeight:function(t){var e=a.tab.height()+t;a.setHeight(e)},setHeight:function(t){a.tab.height(t);a.setContentHeight()},setContentHeight:function(){var e=a.tab.height()-a.tab.links.height();a.tab.content.height(e);t("> .l-tab-content-item",a.tab.content).height(e)},getNewTabid:function(){var t=new Date;return t.getTime()},getTabidList:function(e,i){var n=[];t("> li",a.tab.links.ul).each(function(){if(t(this).attr("tabid")&&t(this).attr("tabid")!=e&&(!i||t(".l-tab-links-item-close",this).length>0)){n.push(t(this).attr("tabid"))}});return n},removeOther:function(e,i){var n=a.getTabidList(e,true);t(n).each(function(){a.removeTabItem(this)})},reload:function(e){t(".l-tab-content-item[tabid="+e+"] iframe",a.tab.content).each(function(e,a){t(a).attr("src",t(a).attr("src"))})},location:function(e,i){t(".l-tab-content-item[tabid="+e+"] iframe",a.tab.content).each(function(e,a){t(a).attr("src",i)})},removeAll:function(e){var i=a.getTabidList(null,true);t(i).each(function(){a.removeTabItem(this)})},onResize:function(){if(!e.height||typeof e.height!="string"||e.height.indexOf("%")==-1)return false;if(a.tab.parent()[0].tagName.toLowerCase()=="body"){var i=t(window).height();i-=parseInt(a.tab.parent().css("paddingTop"));i-=parseInt(a.tab.parent().css("paddingBottom"));a.height=e.heightDiff+i*parseFloat(a.height)*.01}else{a.height=e.heightDiff+a.tab.parent().height()*parseFloat(e.height)*.01}a.tab.height(a.height);a.setContentHeight()}};var i={menuItemClick:function(t){if(!t.id||!a.actionTabid)return;switch(t.id){case"close":a.removeTabItem(a.actionTabid);a.actionTabid=null;break;case"closeother":a.removeOther(a.actionTabid);break;case"closeall":a.removeAll();a.actionTabid=null;break;case"reload":a.selectTabItem(a.actionTabid);a.reload(a.actionTabid);break}},addTabItemContextMenuEven:function(e){e.bind("contextmenu",function(i){if(!a.tab.menu)return;a.actionTabid=e.attr("tabid");a.tab.menu.show({top:i.pageY,left:i.pageX});if(t(".l-tab-links-item-close",this).length==0){a.tab.menu.setDisable("close")}else{a.tab.menu.setEnable("close")}return false})}};if(e.height)a.makeFullHeight=true;a.tab=t(this);if(!a.tab.hasClass("l-tab"))a.tab.addClass("l-tab");if(e.contextmenu&&t.ligerMenu){a.tab.menu=t.ligerMenu({width:100,items:[{text:e.closeMessage,id:"close",click:i.menuItemClick},{text:e.closeOtherMessage,id:"closeother",click:i.menuItemClick},{text:e.closeAllMessage,id:"closeall",click:i.menuItemClick},{text:e.reloadMessage,id:"reload",click:i.menuItemClick}]})}a.tab.content=t('<div class="l-tab-content"></div>');t("> div",a.tab).appendTo(a.tab.content);a.tab.content.appendTo(a.tab);a.tab.links=t('<div class="l-tab-links"><ul style="left: 0px; "></ul></div>');a.tab.links.prependTo(a.tab);a.tab.links.ul=t("ul",a.tab.links);if(e.isVerticalTab){t("li",a.tab.links.ul).each(function(){t(this).css("float","left")});a.tab.links.css({"float":"left",width:"20%"});a.tab.content.css({"float":"left",width:"80%"})}var n=t("> div[lselected=true]",a.tab.content).length>0;a.selectedTabId=t("> div[lselected=true]",a.tab.content).attr("tabid");t("> div",a.tab.content).each(function(e,i){var l=t('<li class=""><div class="maintab_left"><a></a></div><div class="maintab_right"></div></li>');if(t(i).attr("title")){t(".maintab_left > a",l).html(t(i).attr("title"))}var s=t(i).attr("tabid");var r=t(i).attr("icon");if(r){t(".maintab_left > a",l).before('<span class="'+r+'"></span>')}var o=t(i).attr("leftUrl");var b=t(i).attr("rightUrl");o&&l.attr("leftUrl",o);b&&l.attr("rightUrl",b);if(s==undefined){s=a.getNewTabid();t(i).attr("tabid",s);if(t(i).attr("lselected")){a.selectedTabId=s}}l.attr("tabid",s);if(!n&&e==0)a.selectedTabId=s;var c=t(i).attr("showClose");if(c){l.append("<div class='l-tab-links-item-close'></div>")}t("> ul",a.tab.links).append(l);if(!t(i).hasClass("l-tab-content-item"))t(i).addClass("l-tab-content-item")});a.selectTabItem(a.selectedTabId);if(e.height){if(typeof e.height=="string"&&e.height.indexOf("%")>0){a.onResize();if(e.changeHeightOnResize){t(window).resize(function(){a.onResize()})}}else{a.setHeight(e.height)}}if(a.makeFullHeight)a.setContentHeight();t("li",a.tab.links).each(function(){a.addTabItemEvent(t(this))});if(this.id==undefined)this.id="LigerUI_"+(new Date).getTime();LigerUIManagers[this.id+"_Tab"]=a;this.usedTab=true});if(this.length==0)return null;if(this.length==1)return LigerUIManagers[this[0].id+"_Tab"];var a=[];this.each(function(){a.push(LigerUIManagers[this.id+"_Tab"])});return a}})(jQuery);