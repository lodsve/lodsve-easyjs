var TrimPath;(function(){if(TrimPath==null)TrimPath=new Object;if(TrimPath.evalEx==null)TrimPath.evalEx=function(src){return eval(src)};var UNDEFINED;if(Array.prototype.pop==null)Array.prototype.pop=function(){if(this.length===0){return UNDEFINED}return this[--this.length]};if(Array.prototype.push==null)Array.prototype.push=function(){for(var e=0;e<arguments.length;++e){this[this.length]=arguments[e]}return this.length};TrimPath.parseTemplate=function(e,t,r){if(r==null)r=TrimPath.parseTemplate_etc;var i=parse(e,t,r);var n=TrimPath.evalEx(i,t,1);if(n!=null)return new r.Template(t,e,i,n,r);return null};try{String.prototype.process=function(e,t){var r=TrimPath.parseTemplate(this,null);if(r!=null)return r.process(e,t);return this}}catch(e){}TrimPath.parseTemplate_etc={};TrimPath.parseTemplate_etc.statementTag="forelse|for|if|elseif|else|var|macro";TrimPath.parseTemplate_etc.statementDef={"if":{delta:1,prefix:"if (",suffix:") {",paramMin:1},"else":{delta:0,prefix:"} else {"},elseif:{delta:0,prefix:"} else if (",suffix:") {",paramDefault:"true"},"/if":{delta:-1,prefix:"}"},"for":{delta:1,paramMin:3,prefixFunc:function(e,t,r,i){if(e[2]!="in")throw new i.ParseError(r,t.line,"bad for loop statement: "+e.join(" "));var n=e[1];var a="__LIST__"+n;return["var ",a," = ",e[3],";","var __LENGTH_STACK__;","if (typeof(__LENGTH_STACK__) == 'undefined' || !__LENGTH_STACK__.length) __LENGTH_STACK__ = new Array();","__LENGTH_STACK__[__LENGTH_STACK__.length] = 0;","if ((",a,") != null) { ","var ",n,"_ct = 0;","for (var ",n,"_index in ",a,") { ",n,"_ct++;","if (typeof(",a,"[",n,"_index]) == 'function') {continue;}","__LENGTH_STACK__[__LENGTH_STACK__.length - 1]++;","var ",n," = ",a,"[",n,"_index];"].join("")}},forelse:{delta:0,prefix:"} } if (__LENGTH_STACK__[__LENGTH_STACK__.length - 1] == 0) { if (",suffix:") {",paramDefault:"true"},"/for":{delta:-1,prefix:"} }; delete __LENGTH_STACK__[__LENGTH_STACK__.length - 1];"},"var":{delta:0,prefix:"var ",suffix:";"},macro:{delta:1,prefixFunc:function(e,t,r,i){var n=e[1].split("(")[0];return["var ",n," = function",e.slice(1).join(" ").substring(n.length),"{ var _OUT_arr = []; var _OUT = { write: function(m) { if (m) _OUT_arr.push(m); } }; "].join("")}},"/macro":{delta:-1,prefix:" return _OUT_arr.join(''); };"}};TrimPath.parseTemplate_etc.modifierDef={eat:function(e){return""},escape:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},capitalize:function(e){return String(e).toUpperCase()},"default":function(e,t){return e!=null?e:t}};TrimPath.parseTemplate_etc.modifierDef.h=TrimPath.parseTemplate_etc.modifierDef.escape;TrimPath.parseTemplate_etc.Template=function(e,t,r,i,n){this.process=function(e,t){if(e==null)e={};if(e._MODIFIERS==null)e._MODIFIERS={};if(e.defined==null)e.defined=function(t){return e[t]!=undefined};for(var r in n.modifierDef){if(e._MODIFIERS[r]==null)e._MODIFIERS[r]=n.modifierDef[r]}if(t==null)t={};var a=[];var s={write:function(e){a.push(e)}};try{i(s,e,t)}catch(l){if(t.throwExceptions==true)throw l;var f=new String(a.join("")+"[ERROR: "+l.toString()+(l.message?"; "+l.message:"")+"]");f["exception"]=l;return f}return a.join("")};this.name=e;this.source=t;this.sourceFunc=r;this.toString=function(){return"TrimPath.Template ["+e+"]"}};TrimPath.parseTemplate_etc.ParseError=function(e,t,r){this.name=e;this.line=t;this.message=r};TrimPath.parseTemplate_etc.ParseError.prototype.toString=function(){return"TrimPath template ParseError in "+this.name+": line "+this.line+", "+this.message};var parse=function(e,t,r){e=cleanWhiteSpace(e);var i=["var TrimPath_Template_TEMP = function(_OUT, _CONTEXT, _FLAGS) { with (_CONTEXT) {"];var n={stack:[],line:1};var a=-1;while(a+1<e.length){var s=a;s=e.indexOf("{",s+1);while(s>=0){var l=e.indexOf("}",s+1);var f=e.substring(s,l);var u=f.match(/^\{(cdata|minify|eval)/);if(u){var p=u[1];var h=s+p.length+1;var c=e.indexOf("}",h);if(c>=0){var o;if(c-h<=0){o="{/"+p+"}"}else{o=e.substring(h+1,c)}var m=e.indexOf(o,c+1);if(m>=0){emitSectionText(e.substring(a+1,s),i);var T=e.substring(c+1,m);if(p=="cdata"){emitText(T,i)}else if(p=="minify"){emitText(scrubWhiteSpace(T),i)}else if(p=="eval"){if(T!=null&&T.length>0)i.push("_OUT.write( (function() { "+T+" })() );")}s=a=m+o.length-1}}}else if(e.charAt(s-1)!="$"&&e.charAt(s-1)!="\\"){var _=e.charAt(s+1)=="/"?2:1;if(e.substring(s+_,s+10+_).search(TrimPath.parseTemplate_etc.statementTag)==0)break}s=e.indexOf("{",s+1)}if(s<0)break;var l=e.indexOf("}",s+1);if(l<0)break;emitSectionText(e.substring(a+1,s),i);emitStatement(e.substring(s,l+1),n,i,t,r);a=l}emitSectionText(e.substring(a+1),i);if(n.stack.length!=0)throw new r.ParseError(t,n.line,"unclosed, unmatched statement(s): "+n.stack.join(","));i.push("}}; TrimPath_Template_TEMP");return i.join("")};var emitStatement=function(e,t,r,i,n){var a=e.slice(1,-1).split(" ");var s=n.statementDef[a[0]];if(s==null){emitSectionText(e,r);return}if(s.delta<0){if(t.stack.length<=0)throw new n.ParseError(i,t.line,"close tag does not match any previous statement: "+e);t.stack.pop()}if(s.delta>0)t.stack.push(e);if(s.paramMin!=null&&s.paramMin>=a.length)throw new n.ParseError(i,t.line,"statement needs more parameters: "+e);if(s.prefixFunc!=null)r.push(s.prefixFunc(a,t,i,n));else r.push(s.prefix);if(s.suffix!=null){if(a.length<=1){if(s.paramDefault!=null)r.push(s.paramDefault)}else{for(var l=1;l<a.length;l++){if(l>1)r.push(" ");r.push(a[l])}}r.push(s.suffix)}};var emitSectionText=function(e,t){if(e.length<=0)return;var r=0;var i=e.length-1;while(r<e.length&&e.charAt(r)=="\n")r++;while(i>=0&&(e.charAt(i)==" "||e.charAt(i)=="	"))i--;if(i<r)i=r;if(r>0){t.push('if (_FLAGS.keepWhitespace == true) _OUT.write("');var n=e.substring(0,r).replace("\n","\\n");if(n.charAt(n.length-1)=="\n")n=n.substring(0,n.length-1);t.push(n);t.push('");')}var a=e.substring(r,i+1).split("\n");for(var s=0;s<a.length;s++){emitSectionTextLine(a[s],t);if(s<a.length-1)t.push('_OUT.write("\\n");\n')}if(i+1<e.length){t.push('if (_FLAGS.keepWhitespace == true) _OUT.write("');var n=e.substring(i+1).replace("\n","\\n");if(n.charAt(n.length-1)=="\n")n=n.substring(0,n.length-1);t.push(n);t.push('");')}};var emitSectionTextLine=function(e,t){var r="}";var i=-1;while(i+r.length<e.length){var n="${",a="}";var s=e.indexOf(n,i+r.length);if(s<0)break;if(e.charAt(s+2)=="%"){n="${%";a="%}"}var l=e.indexOf(a,s+n.length);if(l<0)break;emitText(e.substring(i+r.length,s),t);var f=e.substring(s+n.length,l).replace(/\|\|/g,"#@@#").split("|");for(var u in f){if(f[u].replace)f[u]=f[u].replace(/#@@#/g,"||")}t.push("_OUT.write(");emitExpression(f,f.length-1,t);t.push(");");i=l;r=a}emitText(e.substring(i+r.length),t)};var emitText=function(e,t){if(e==null||e.length<=0)return;e=e.replace(/\\/g,"\\\\");e=e.replace(/\n/g,"\\n");e=e.replace(/"/g,'\\"');t.push('_OUT.write("');t.push(e);t.push('");')};var emitExpression=function(e,t,r){var i=e[t];if(t<=0){r.push(i);return}var n=i.split(":");r.push('_MODIFIERS["');r.push(n[0]);r.push('"](');emitExpression(e,t-1,r);if(n.length>1){r.push(",");r.push(n[1])}r.push(")")};var cleanWhiteSpace=function(e){e=e.replace(/\t/g,"    ");e=e.replace(/\r\n/g,"\n");e=e.replace(/\r/g,"\n");e=e.replace(/^(\s*\S*(\s+\S+)*)\s*$/,"$1");return e};var scrubWhiteSpace=function(e){e=e.replace(/^\s+/g,"");e=e.replace(/\s+$/g,"");e=e.replace(/\s+/g," ");e=e.replace(/^(\s*\S*(\s+\S+)*)\s*$/,"$1");return e};TrimPath.parseDOMTemplate=function(e,t,r){if(t==null)t=document;var i=t.getElementById(e);var n=i.value;if(n==null)n=i.innerHTML;n=n.replace(/&lt;/g,"<").replace(/&gt;/g,">");return TrimPath.parseTemplate(n,e,r)};TrimPath.processDOMTemplate=function(e,t,r,i,n){return TrimPath.parseDOMTemplate(e,i,n).process(t,r)};TrimPath.process=TrimPath.processDOMTemplate;TrimPath.from=TrimPath.parseDOMTemplate;$.util.from=TrimPath.from})();