(function(e){e.swfupload=e.swfupload||{};e.swfupload.defaults={title:"上传文件",uploadUrl:easyloader.URI+"/upload/upload.do",close:true,modal:true,draggable:true,fileTypeDescription:"请选择附件",fileTypes:"*.*",fileSizeLimit:100*1024*1024,totalUploadSize:1024*1024*1024,completeFunction:"attachUploadComplete",params:{},width:630,height:450,closeAll:true,canDeleteAfterUpload:true,canDownloadAfterUpload:true};e.swfupload.uploadDialog=e.swfupload.uploadDialog||null;e.fn.swfupload=function(a,t){this.each(function(){t=e.extend({},e.swfupload.defaults,t||{});top.$.swfupload.resources={element:a,resourceId:t.params.resourceId,resourceType:t.params.resourceType,uploadId:t.params.uploadId,closeAll:t.closeAll,canDeleteAfterUpload:t.canDeleteAfterUpload,canDownloadAfterUpload:t.canDownloadAfterUpload};var o={bodyHtml:function(){var e="";var a='<div class="uploadTips">提示信息:可上传的单个文件最大尺寸为：1G</div>';e+='<div name="upcontent" id="flashContent" style="display:block;overflow:hidden;height:350px;">'+o.flashHtml()+"</div>"+a;e+='<div name="upcontent" id="templateContent" style="display:none;height:400px;overflow-y: scroll;"></div>';return e},flashHtml:function(){var e=new Array;e.push('<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"');e.push('codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0"');e.push('	width="100%" height="100%" id="file" align="middle">');e.push('	<param name="allowScriptAccess" value="sameDomain" />');e.push('	<param name="movie" value="'+easyloader.base+'/js/swfupload/FlashFileUpload.swf?ver=123484" />');e.push('   <param name="quality" value="high" />');e.push('	<param name="wmode" value="transparent">');var a="&fileTypeDescription="+encodeURIComponent(t.fileTypeDescription)+"&fileTypes="+encodeURIComponent(t.fileTypes)+"&fileSizeLimit="+encodeURIComponent(t.fileSizeLimit)+"&totalUploadSize="+encodeURIComponent(t.totalUploadSize)+"&completeFunction="+encodeURIComponent(t.completeFunction);a=o.getSubmitUrl()+a;e.push('    <param name="FlashVars" value=\''+a+"'>");e.push('    <embed src="'+easyloader.base+'/swfupload/FlashFileUpload.swf?ver=123484" '+"FlashVars='"+a+"'");e.push(' quality="high" wmode="transparent" width="100%" height="100%" name="file"');e.push(' align="middle" allowscriptaccess="sameDomain" type="application/x-shockwave-flash"');e.push(' pluginspage="http://www.macromedia.com/go/getflashplayer" />');e.push("</object>");return e.join("")},getSubmitUrl:function(){var e="uploadPage="+t.uploadUrl;var a=t.params;e+="%3FuserId="+(a.userId?a.userId:-1);e+="%26headImage="+(a.headImage?a.headImage:"false");e+="%26resourceId="+(a.resourceId?a.resourceId:-1);e+="%26resourceType="+(a.resourceType?a.resourceType:-1);e+="%26uploadId="+(a.uploadId?a.uploadId:-1);return e},show:function(){e.swfupload.uploadDialog=top.$.ligerDialog.open({title:t.title,content:o.bodyHtml(),width:t.width,height:t.height,allowClose:t.allowClose,isDrag:t.draggable,modal:t.modal,buttons:[{text:"关闭",onclick:function(e,a){a.close()}}]})}};var s=e('<img src="'+easyloader.URI+'/js/easyjs/skins/icons/plus-gray.png" class="plus-icon"/>');e(this).before(s);e(this).addClass("btn-input");e(this).mouseover(function(){e(this).addClass("btn-hover")});e(this).mouseout(function(){e(this).removeClass("btn-hover")});e(this).click(function(){o.show()})})}})(jQuery);function attachUploadComplete(x){var res=top.$.swfupload.resources;var element=res.element;if("string"==typeof element){element=$("#"+element)}showAttachments(element,res,res.canDeleteAfterUpload,res.canDownloadAfterUpload);if(x){x=eval("("+x+")")}else{x={}}var files=x.totalFiles,size=x.totalSize;var style="margin: 10px 10px 0 0;font-weight: bold;padding: 0 10px;";var style2="background: none repeat scroll 0 0 #2782D6;height: 20px;margin: 10px 10px 0;";var tipMsg="<div style='"+style2+"'></div>"+"<p style='"+style+"'>已经上传100%，成功上传 "+files+" 个文件,共"+size+"</p>";$.ligerDialog.open({title:"上传成功",content:tipMsg,width:460,height:150,buttons:[{text:"继续上传",onclick:function(e,a){a.close()}},{text:"结束上传",onclick:function(e,a){a.close();$.swfupload.uploadDialog.close()}}]})}function showAttachments(e,a,t,o){var s=a.resourceId,l=a.resourceType,n=a.uploadId;var i=easyloader.URI+"/upload/showUploads.do?resourceId="+s+"&resourceType="+l+"&uploadId="+n;if(!s)return;$.ajax({type:"GET",url:i,data:"",dataType:"json",success:function(a){var s=a.files;try{if(a.status==1){var l=createShowHTML(s,t,o);e.html(l);for(var n=0;n<s.length;n++){$("#delConfirm"+s[n].pkId).confirm({confirmMessage:"元素",isFormatMessage:true,removeElement:$("#file"+s[n].pkId)})}if(jQuery.browser.msie){$("span.delete").css({right:"25px"})}}}catch(i){}},error:function(e,a,t){}})}function createShowHTML(e,a,t){var o=[];o.push('<div class="post-attachments-div">');o.push('    <div class="post-attachments-title">附件：</div>');o.push('    <div class="post-attachments-files">');var s={attachments:e,canDelete:a,download:t};var l=$.util.from("displayAttachments");var n=l.process(s);o.push(n);o.push("</div></div>");return o.join("")}function deleteFile(e){$.ligerDialog.open({title:"提示",content:"你确定要删除选中的文件吗？",buttons:[{text:"确定",onclick:function(a,t){var o=easyloader.URI+"/upload/delete.do?fileId="+e;$.ajax({type:"GET",url:o,data:"",dataType:"json",success:function(a){t.close();try{if(a.status==1){$("#file"+e).hide();showTip("suc",e)}else{showTip("err",e)}}catch(o){}},error:function(e,a,t){}})}},{text:"取消",onclick:function(e,a){a.close()}}]})}function showTip(e,a){var t=window.document.createElement("span");t.id="tip"+a;t.innerHTML=e=="suc"?"删除成功":"删除失败";t.className=e=="suc"?"sucTip":"errTip";$("#file"+a).before(t);setTimeout(function(){$("#tip"+a).hide()},500)}(function(e){e.showAttachments=e.showAttachments||{};e.showAttachments.defaults={resourceId:"",resourceType:"",uploadId:"",canDelete:false,canDownload:true};e.fn.showAttachments=function(a){this.each(function(){var t=e(this);a=e.extend({},e.showAttachments.defaults,a||{});var o={show:function(e){showAttachments(t,e,e.canDelete,e.canDownload)}};o.show(a)})}})(jQuery);